<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC0z364Ti3fBTrcVzAPgyQamA-JioGTPXo",
            authDomain: "employee-management-36cb3.firebaseapp.com",
            projectId: "employee-management-36cb3",
            storageBucket: "employee-management-36cb3.firebasestorage.app",
            messagingSenderId: "114401704510",
            appId: "1:114401704510:web:205da2b3ccae3533bbaf6f",
            measurementId: "G-JT8FQB7VTE"
        };
        
        // Initialize Firebase
        let db;
        let useFirebase = false;
        
        try {
            if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                useFirebase = true;
                console.log("Firebase initialized successfully");
            } else {
                console.log("Firebase not configured - using localStorage");
            }
        } catch (error) {
            console.log("Firebase initialization failed - using localStorage", error);
        }
        
        // Lucide React icons as inline SVG components
        const Clock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );
        
        const LogOut = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        );
        
        const Edit2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );
        
        const Plus = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );
        
        const Eye = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        );
        
        const EyeOff = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
        );
        
        const Trash2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );
        
        const Save = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
        );
        
        const X = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );
        
        const AlertCircle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );
        
        const Users = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );
        
        const Download = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );
        
        const Calendar = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );
        
        const Filter = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
        );
        
        const Coffee = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                <line x1="6" y1="1" x2="6" y2="4"></line>
                <line x1="10" y1="1" x2="10" y2="4"></line>
                <line x1="14" y1="1" x2="14" y2="4"></line>
            </svg>
        );
        
        const ChevronUp = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
        );
        
        const ChevronDown = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        // IP Address Restriction Configuration
        const IPRestriction = {
            enabled: true, // Set to false to disable IP checking globally
            
            checkEmployeeIP: async (employee) => {
                if (!IPRestriction.enabled) {
                    return { allowed: true, ip: 'IP checking disabled' };
                }
                
                // If employee has no IPs configured, allow access (for backward compatibility)
                if (!employee.allowedIPs || employee.allowedIPs.length === 0) {
                    return { allowed: true, ip: 'No IP restriction set for this employee' };
                }
                
                try {
                    // Get user's IP address
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    const userIP = data.ip;
                    
                    const allowed = employee.allowedIPs.includes(userIP);
                    return { allowed, ip: userIP, allowedIPs: employee.allowedIPs };
                } catch (error) {
                    console.error('Error checking IP:', error);
                    // If IP check fails, allow access (you can change this to deny if preferred)
                    return { allowed: true, ip: 'IP check failed' };
                }
            }
        };

        // Session management helper functions
        const SessionManager = {
            saveSession: (type, data) => {
                const session = {
                    type: type, // 'owner' or 'employee'
                    data: data,
                    loginTime: new Date().getTime(),
                    expiresIn: 8 * 60 * 60 * 1000 // 8 hours in milliseconds
                };
                localStorage.setItem('userSession', JSON.stringify(session));
            },
            
            getSession: () => {
                const stored = localStorage.getItem('userSession');
                if (!stored) return null;
                
                const session = JSON.parse(stored);
                const currentTime = new Date().getTime();
                const sessionAge = currentTime - session.loginTime;
                
                // Check if session has expired (8 hours)
                if (sessionAge > session.expiresIn) {
                    SessionManager.clearSession();
                    return null;
                }
                
                return session;
            },
            
            clearSession: () => {
                localStorage.removeItem('userSession');
            },
            
            isSessionValid: () => {
                return SessionManager.getSession() !== null;
            }
        };

        // Storage helper functions
        const Storage = {
            getOwner: () => {
                const stored = localStorage.getItem('owner');
                return stored ? JSON.parse(stored) : { 
                    username: 'admin', 
                    password: 'admin123',
                    dailyTasks: [
                        { id: 1, task: 'Review employee work logs', completed: false },
                        { id: 2, task: 'Check system reports', completed: false }
                    ],
                    assignedTasks: [
                        { id: 1, task: 'Prepare monthly performance review', completed: false },
                        { id: 2, task: 'Update company policies', completed: false }
                    ]
                };
            },
            
            saveOwner: (owner) => {
                localStorage.setItem('owner', JSON.stringify(owner));
            },
            
            getEmployees: () => {
                const stored = localStorage.getItem('employees');
                return stored ? JSON.parse(stored) : [
                    {
                        id: 1,
                        username: 'john.doe',
                        password: 'pass123',
                        name: 'John Doe',
                        allowedIPs: [], // Add office IPs for this employee
                        clockedIn: false,
                        clockInTime: null,
                        clockOutTime: null,
                        workHistory: [],
                        schedule: {
                            openingTime: '09:00',
                            closingTime: '17:00',
                            timezone: 'America/Toronto'
                        },
                        dailyTasks: [
                            { id: 1, task: 'Check emails', completed: false },
                            { id: 2, task: 'Update daily report', completed: false },
                            { id: 3, task: 'Team standup meeting', completed: false }
                        ],
                        assignedTasks: [
                            { id: 1, task: 'Complete project documentation', completed: false },
                            { id: 2, task: 'Review code submissions', completed: false }
                        ],
                        notes: '',
                        assignedBreakMinutes: 30, // Break time assigned by owner
                        onBreak: false,
                        breakStartTime: null,
                        breakPausedTime: null,
                        breakTimeUsed: 0, // Minutes of break time used
                        isPaused: false
                    },
                    {
                        id: 2,
                        username: 'jane.smith',
                        password: 'pass456',
                        name: 'Jane Smith',
                        allowedIPs: [], // Add office IPs for this employee
                        clockedIn: false,
                        clockInTime: null,
                        clockOutTime: null,
                        workHistory: [],
                        schedule: {
                            openingTime: '09:00',
                            closingTime: '17:00',
                            timezone: 'America/Toronto'
                        },
                        dailyTasks: [
                            { id: 1, task: 'Check emails', completed: false },
                            { id: 2, task: 'Update daily report', completed: false }
                        ],
                        assignedTasks: [
                            { id: 1, task: 'Client presentation prep', completed: false }
                        ],
                        notes: '',
                        assignedBreakMinutes: 60, // Break time assigned by owner
                        onBreak: false,
                        breakStartTime: null,
                        breakPausedTime: null,
                        breakTimeUsed: 0,
                        isPaused: false
                    }
                ];
            },
            
            saveEmployees: (employees) => {
                localStorage.setItem('employees', JSON.stringify(employees));
            },
            
            saveOwner: (owner) => {
                localStorage.setItem('owner', JSON.stringify(owner));
            }
        };

        // Firebase helper functions
        const FirebaseDB = {
            loadEmployees: async (setEmployees) => {
                if (!useFirebase) {
                    setEmployees(Storage.getEmployees());
                    return;
                }
                
                try {
                    const snapshot = await db.collection('employees').get();
                    const employees = [];
                    snapshot.forEach(doc => {
                        employees.push({ ...doc.data(), id: doc.id });
                    });
                    
                    if (employees.length === 0) {
                        // Initialize with default employees
                        const defaultEmployees = Storage.getEmployees();
                        for (const emp of defaultEmployees) {
                            await db.collection('employees').doc(emp.id.toString()).set(emp);
                        }
                        setEmployees(defaultEmployees);
                    } else {
                        setEmployees(employees);
                    }
                } catch (error) {
                    console.error("Error loading employees:", error);
                    setEmployees(Storage.getEmployees());
                }
            },
            
            saveEmployee: async (employee) => {
                if (!useFirebase) {
                    return;
                }
                
                try {
                    await db.collection('employees').doc(employee.id.toString()).set(employee);
                } catch (error) {
                    console.error("Error saving employee:", error);
                }
            },
            
            deleteEmployee: async (employeeId) => {
                if (!useFirebase) {
                    return;
                }
                
                try {
                    await db.collection('employees').doc(employeeId.toString()).delete();
                } catch (error) {
                    console.error("Error deleting employee:", error);
                }
            }
        };

        const App = () => {
            const [currentView, setCurrentView] = useState('selectRole');
            const [ownerDashboardView, setOwnerDashboardView] = useState('history'); // 'history' or 'manage'
            const [employees, setEmployees] = useState([]);
            const [owner, setOwner] = useState(Storage.getOwner());
            const [currentEmployee, setCurrentEmployee] = useState(null);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [error, setError] = useState('');
            const [editingEmployee, setEditingEmployee] = useState(null);
            const [showPassword, setShowPassword] = useState({});
            const [newEmployee, setNewEmployee] = useState({ username: '', password: '', name: '', phone: '', email: '', idDocument: null });
            const [editingDailyTasks, setEditingDailyTasks] = useState(null);
            const [newDailyTask, setNewDailyTask] = useState('');
            const [newAssignedTask, setNewAssignedTask] = useState('');
            const [addingTaskTo, setAddingTaskTo] = useState(null);
            const [loading, setLoading] = useState(true);
            
            // New state for date range filter and editing work history
            const [dateRangeFilter, setDateRangeFilter] = useState({ start: '', end: '' });
            const [editingWorkEntry, setEditingWorkEntry] = useState(null);
            const [editingWorkTimes, setEditingWorkTimes] = useState({ clockIn: '', clockOut: '' });
            
            // State for editing task text
            const [editingTaskId, setEditingTaskId] = useState(null);
            const [editingTaskText, setEditingTaskText] = useState('');
            
            // State for notes save status
            const [notesSaveStatus, setNotesSaveStatus] = useState('saved'); // 'saved', 'saving'
            
            // State for break timer
            const [breakTimeRemaining, setBreakTimeRemaining] = useState(0);
            
            // State for selected employee in sidebar layout
            const [selectedEmployee, setSelectedEmployee] = useState(null);

            // Check for existing session on mount
            useEffect(() => {
                const session = SessionManager.getSession();
                if (session) {
                    if (session.type === 'owner') {
                        setCurrentView('ownerDashboard');
                    } else if (session.type === 'employee') {
                        // Find the employee in the data
                        const loadEmployeeSession = async () => {
                            await FirebaseDB.loadEmployees(setEmployees);
                            // We'll set the employee after data loads
                        };
                        loadEmployeeSession();
                    }
                }
            }, []);

            // Restore employee session after employees are loaded
            useEffect(() => {
                if (employees.length > 0 && currentView === 'selectRole') {
                    const session = SessionManager.getSession();
                    if (session && session.type === 'employee') {
                        const employee = employees.find(emp => emp.id === session.data.id);
                        if (employee) {
                            setCurrentEmployee(employee);
                            setCurrentView('employeeDashboard');
                        }
                    }
                }
            }, [employees]);

            // Load employees on mount
            useEffect(() => {
                const loadData = async () => {
                    await FirebaseDB.loadEmployees(setEmployees);
                    setLoading(false);
                };
                loadData();
            }, []);

            // Save employees whenever they change
            useEffect(() => {
                if (!loading && employees.length > 0) {
                    Storage.saveEmployees(employees);
                    
                    if (useFirebase) {
                        employees.forEach(emp => {
                            FirebaseDB.saveEmployee(emp);
                        });
                    }
                }
            }, [employees, loading]);
            
            // Save owner data whenever it changes
            useEffect(() => {
                if (owner) {
                    Storage.saveOwner(owner);
                }
            }, [owner]);
            
            // Break timer - auto end when time runs out
            useEffect(() => {
                if (currentView === 'employeeDashboard' && currentEmployee?.onBreak && !currentEmployee?.isPaused) {
                    const interval = setInterval(() => {
                        const now = new Date();
                        const breakStart = new Date(currentEmployee.breakStartTime);
                        const timeElapsed = (now - breakStart) / (1000 * 60); // minutes
                        const totalUsed = (currentEmployee.breakTimeUsed || 0) + timeElapsed;
                        const remaining = (currentEmployee.assignedBreakMinutes || 30) - totalUsed;
                        
                        setBreakTimeRemaining(Math.max(0, remaining));
                        
                        // Auto end break when time runs out
                        if (remaining <= 0) {
                            handleEndBreak();
                        }
                    }, 1000); // Update every second
                    
                    return () => clearInterval(interval);
                }
            }, [currentView, currentEmployee]);

            // Prevent closing browser/tab without clocking out - Auto clock out on close
            useEffect(() => {
                if (currentView === 'employeeDashboard' && currentEmployee?.clockedIn) {
                    const handleBeforeUnload = (e) => {
                        // Show warning
                        e.preventDefault();
                        e.returnValue = 'You are still clocked in! If you close this tab, you will be automatically clocked out.';
                        
                        // Auto clock-out when the page unloads
                        const handleUnload = () => {
                            const now = new Date();
                            const clockInDate = new Date(currentEmployee.clockInTime);
                            const hoursWorked = ((now - clockInDate) / (1000 * 60 * 60)).toFixed(2);
                            
                            // Create work history entry
                            const workEntry = {
                                id: Date.now(),
                                date: now.toISOString(),
                                clockIn: currentEmployee.clockInTime,
                                clockOut: now.toISOString(),
                                hoursWorked: parseFloat(hoursWorked),
                                autoClockOut: true // Flag for auto clock-out
                            };
                            
                            // Update employee data
                            const updatedEmployee = {
                                ...currentEmployee,
                                clockedIn: false,
                                clockOutTime: now.toISOString(),
                                workHistory: [...(currentEmployee.workHistory || []), workEntry],
                                dailyTasks: currentEmployee.dailyTasks.map(task => ({ ...task, completed: false })),
                                assignedTasks: currentEmployee.assignedTasks.filter(task => !task.completed)
                            };
                            
                            // Get all employees and update
                            const allEmployees = Storage.getEmployees();
                            const updatedEmployees = allEmployees.map(emp =>
                                emp.id === currentEmployee.id ? updatedEmployee : emp
                            );
                            Storage.saveEmployees(updatedEmployees);
                            
                            // Clear session
                            SessionManager.clearSession();
                        };
                        
                        return e.returnValue;
                    };
                    
                    const handleUnload = () => {
                        if (currentEmployee?.clockedIn) {
                            const now = new Date();
                            const clockInDate = new Date(currentEmployee.clockInTime);
                            const hoursWorked = ((now - clockInDate) / (1000 * 60 * 60)).toFixed(2);
                            
                            const workEntry = {
                                id: Date.now(),
                                date: now.toISOString(),
                                clockIn: currentEmployee.clockInTime,
                                clockOut: now.toISOString(),
                                hoursWorked: parseFloat(hoursWorked),
                                autoClockOut: true
                            };
                            
                            const updatedEmployee = {
                                ...currentEmployee,
                                clockedIn: false,
                                clockOutTime: now.toISOString(),
                                workHistory: [...(currentEmployee.workHistory || []), workEntry],
                                dailyTasks: currentEmployee.dailyTasks.map(task => ({ ...task, completed: false })),
                                assignedTasks: currentEmployee.assignedTasks.filter(task => !task.completed)
                            };
                            
                            const allEmployees = Storage.getEmployees();
                            const updatedEmployees = allEmployees.map(emp =>
                                emp.id === currentEmployee.id ? updatedEmployee : emp
                            );
                            Storage.saveEmployees(updatedEmployees);
                            SessionManager.clearSession();
                        }
                    };
                    
                    window.addEventListener('beforeunload', handleBeforeUnload);
                    window.addEventListener('unload', handleUnload);
                    return () => {
                        window.removeEventListener('beforeunload', handleBeforeUnload);
                        window.removeEventListener('unload', handleUnload);
                    };
                }
            }, [currentView, currentEmployee]);

            const handleOwnerLogin = (e) => {
                e.preventDefault();
                const owner = Storage.getOwner();
                if (loginForm.username === owner.username && loginForm.password === owner.password) {
                    SessionManager.saveSession('owner', { username: owner.username });
                    setCurrentView('ownerDashboard');
                    setError('');
                    setLoginForm({ username: '', password: '' });
                } else {
                    setError('Invalid credentials');
                }
            };

            const handleEmployeeLogin = async (e) => {
                e.preventDefault();
                
                const employee = employees.find(
                    emp => emp.username === loginForm.username && emp.password === loginForm.password
                );
                
                if (!employee) {
                    setError('Invalid credentials');
                    return;
                }
                
                // Check IP address for this specific employee
                const ipCheck = await IPRestriction.checkEmployeeIP(employee);
                if (!ipCheck.allowed) {
                    setError(`Access denied. You can only login from your assigned office location(s). Your current IP: ${ipCheck.ip}`);
                    return;
                }
                
                SessionManager.saveSession('employee', { id: employee.id, username: employee.username });
                setCurrentEmployee(employee);
                setCurrentView('employeeDashboard');
                setError('');
                setLoginForm({ username: '', password: '' });
            };

            const handleClockIn = () => {
                const now = new Date();
                
                // Check if employee is late
                let isLate = false;
                let minutesLate = 0;
                
                if (currentEmployee.schedule && currentEmployee.schedule.openingTime) {
                    const [hours, minutes] = currentEmployee.schedule.openingTime.split(':');
                    const scheduledTime = new Date(now);
                    scheduledTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                    
                    if (now > scheduledTime) {
                        isLate = true;
                        minutesLate = Math.floor((now - scheduledTime) / (1000 * 60));
                    }
                }
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id
                        ? { 
                            ...emp, 
                            clockedIn: true, 
                            clockInTime: now.toISOString(),
                            isLateToday: isLate,
                            minutesLate: minutesLate
                        }
                        : emp
                );
                setEmployees(updatedEmployees);
                setCurrentEmployee({ 
                    ...currentEmployee, 
                    clockedIn: true, 
                    clockInTime: now.toISOString(),
                    isLateToday: isLate,
                    minutesLate: minutesLate,
                    hasBeenAutoClocked: false
                });
            };

            const handleClockOut = () => {
                const allDailyTasksCompleted = currentEmployee.dailyTasks.every(task => task.completed);
                
                if (!allDailyTasksCompleted) {
                    setError('You must complete all daily tasks before clocking out!');
                    setTimeout(() => setError(''), 4000);
                    return;
                }

                const now = new Date();
                const clockInDate = new Date(currentEmployee.clockInTime);
                const totalMinutesWorked = (now - clockInDate) / (1000 * 60);
                
                // Always deduct assigned break time from total hours
                const assignedBreakMinutes = currentEmployee.assignedBreakMinutes || 30;
                const netWorkMinutes = totalMinutesWorked - assignedBreakMinutes;
                const hoursWorked = (netWorkMinutes / 60).toFixed(2);
                
                // Create work history entry
                const workEntry = {
                    id: Date.now(),
                    date: now.toISOString(),
                    clockIn: currentEmployee.clockInTime,
                    clockOut: now.toISOString(),
                    hoursWorked: parseFloat(hoursWorked),
                    assignedBreakMinutes: assignedBreakMinutes,
                    wasLate: currentEmployee.isLateToday || false,
                    minutesLate: currentEmployee.minutesLate || 0
                };
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id
                        ? { 
                            ...emp, 
                            clockedIn: false, 
                            clockOutTime: now.toISOString(),
                            workHistory: [...(emp.workHistory || []), workEntry],
                            dailyTasks: emp.dailyTasks.map(task => ({ ...task, completed: false })),
                            isLateToday: false,
                            minutesLate: 0,
                            onBreak: false,
                            breakStartTime: null,
                            breakPausedTime: null,
                            breakTimeUsed: 0,
                            isPaused: false
                        }
                        : emp
                );
                setEmployees(updatedEmployees);
                setCurrentEmployee({ 
                    ...currentEmployee, 
                    clockedIn: false, 
                    clockOutTime: now.toISOString(),
                    workHistory: [...(currentEmployee.workHistory || []), workEntry],
                    dailyTasks: currentEmployee.dailyTasks.map(task => ({ ...task, completed: false })),
                    assignedTasks: currentEmployee.assignedTasks.filter(task => !task.completed),
                    isLateToday: false,
                    minutesLate: 0
                });
                setError('');
            };

            const handleEmployeeSignOut = () => {
                // Show warning if employee is still clocked in
                if (currentEmployee?.clockedIn) {
                    const confirmed = confirm(
                        '⚠️ Warning: You are still clocked in!\n\n' +
                        'If you sign out now, your clock-in session will remain active.\n' +
                        'You will still be counted as working.\n\n' +
                        'Do you want to sign out anyway?'
                    );
                    
                    if (!confirmed) {
                        return; // User cancelled, don't sign out
                    }
                }
                
                SessionManager.clearSession();
                setCurrentEmployee(null);
                setCurrentView('selectRole');
                setError('');
            };
            
            const handleTakeBreak = () => {
                const now = new Date();
                const updatedEmployee = {
                    ...currentEmployee,
                    onBreak: true,
                    breakStartTime: now.toISOString(),
                    isPaused: false
                };
                setCurrentEmployee(updatedEmployee);
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id ? updatedEmployee : emp
                );
                setEmployees(updatedEmployees);
            };
            
            const handlePauseBreak = () => {
                const now = new Date();
                const breakStart = new Date(currentEmployee.isPaused ? currentEmployee.breakPausedTime : currentEmployee.breakStartTime);
                const timeElapsed = (now - breakStart) / (1000 * 60); // in minutes
                
                const updatedEmployee = {
                    ...currentEmployee,
                    isPaused: true,
                    breakPausedTime: now.toISOString(),
                    breakTimeUsed: (currentEmployee.breakTimeUsed || 0) + timeElapsed
                };
                setCurrentEmployee(updatedEmployee);
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id ? updatedEmployee : emp
                );
                setEmployees(updatedEmployees);
            };
            
            const handleResumeBreak = () => {
                const now = new Date();
                const updatedEmployee = {
                    ...currentEmployee,
                    isPaused: false,
                    breakStartTime: now.toISOString()
                };
                setCurrentEmployee(updatedEmployee);
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id ? updatedEmployee : emp
                );
                setEmployees(updatedEmployees);
            };
            
            const handleEndBreak = () => {
                const now = new Date();
                let totalUsed = currentEmployee.breakTimeUsed || 0;
                
                // Add current session time if not paused
                if (!currentEmployee.isPaused && currentEmployee.breakStartTime) {
                    const breakStart = new Date(currentEmployee.breakStartTime);
                    const timeElapsed = (now - breakStart) / (1000 * 60);
                    totalUsed += timeElapsed;
                }
                
                const updatedEmployee = {
                    ...currentEmployee,
                    onBreak: false,
                    breakStartTime: null,
                    breakPausedTime: null,
                    breakTimeUsed: totalUsed,
                    isPaused: false
                };
                setCurrentEmployee(updatedEmployee);
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id ? updatedEmployee : emp
                );
                setEmployees(updatedEmployees);
            };

            const toggleDailyTask = (taskId) => {
                const updatedTasks = currentEmployee.dailyTasks.map(task =>
                    task.id === taskId ? { ...task, completed: !task.completed } : task
                );
                const updatedEmployee = { ...currentEmployee, dailyTasks: updatedTasks };
                setCurrentEmployee(updatedEmployee);
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id ? updatedEmployee : emp
                );
                setEmployees(updatedEmployees);
            };

            const toggleAssignedTask = (taskId) => {
                const updatedTasks = currentEmployee.assignedTasks.map(task =>
                    task.id === taskId ? { ...task, completed: !task.completed } : task
                );
                const updatedEmployee = { ...currentEmployee, assignedTasks: updatedTasks };
                setCurrentEmployee(updatedEmployee);
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id ? updatedEmployee : emp
                );
                setEmployees(updatedEmployees);
            };
            
            const handleNotesChange = (notes) => {
                setNotesSaveStatus('saving');
                
                const updatedEmployee = { ...currentEmployee, notes: notes };
                setCurrentEmployee(updatedEmployee);
                
                const updatedEmployees = employees.map(emp =>
                    emp.id === currentEmployee.id ? updatedEmployee : emp
                );
                setEmployees(updatedEmployees);
                
                // Show "saved" status after a short delay
                setTimeout(() => {
                    setNotesSaveStatus('saved');
                }, 500);
            };

            const handleAddEmployee = (e) => {
                e.preventDefault();
                if (newEmployee.username && newEmployee.password && newEmployee.name) {
                    const employee = {
                        id: Date.now(),
                        username: newEmployee.username,
                        password: newEmployee.password,
                        name: newEmployee.name,
                        phone: newEmployee.phone || '',
                        email: newEmployee.email || '',
                        idDocument: newEmployee.idDocument || null,
                        allowedIPs: [],
                        clockedIn: false,
                        clockInTime: null,
                        clockOutTime: null,
                        workHistory: [],
                        schedule: {
                            openingTime: '09:00',
                            closingTime: '17:00',
                            timezone: 'America/Toronto'
                        },
                        dailyTasks: [],
                        assignedTasks: [],
                        notes: '',
                        assignedBreakMinutes: 30, // Default 30 minutes
                        onBreak: false,
                        breakStartTime: null,
                        breakPausedTime: null,
                        breakTimeUsed: 0,
                        isPaused: false
                    };
                    setEmployees([...employees, employee]);
                    setNewEmployee({ username: '', password: '', name: '', phone: '', email: '', idDocument: null });
                }
            };
            
            const handleFileUpload = (e, employeeId = null) => {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const base64 = event.target.result;
                        if (employeeId) {
                            // Update existing employee
                            const updatedEmployees = employees.map(emp =>
                                emp.id === employeeId ? { ...emp, idDocument: { name: file.name, data: base64 } } : emp
                            );
                            setEmployees(updatedEmployees);
                        } else {
                            // For new employee
                            setNewEmployee({ ...newEmployee, idDocument: { name: file.name, data: base64 } });
                        }
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('Please upload a PDF file only');
                }
            };

            const handleUpdateEmployee = (employeeId, updates) => {
                const updatedEmployees = employees.map(emp =>
                    emp.id === employeeId ? { ...emp, ...updates } : emp
                );
                setEmployees(updatedEmployees);
                setEditingEmployee(null);
            };

            const handleDeleteEmployee = async (employeeId) => {
                if (window.confirm('Are you sure you want to delete this employee?')) {
                    setEmployees(employees.filter(emp => emp.id !== employeeId));
                    await FirebaseDB.deleteEmployee(employeeId);
                }
            };
            
            const handleClearWorkHistory = (employeeId) => {
                if (window.confirm('Are you sure you want to clear ALL work history for this employee? This cannot be undone!')) {
                    const updatedEmployees = employees.map(emp => {
                        if (emp.id === employeeId) {
                            return {
                                ...emp,
                                workHistory: []
                            };
                        }
                        return emp;
                    });
                    setEmployees(updatedEmployees);
                }
            };
            
            const handleForceClockOut = (employeeId) => {
                if (window.confirm('Are you sure you want to clock out and sign out this employee?')) {
                    const employee = employees.find(emp => emp.id === employeeId);
                    
                    if (!employee || !employee.clockedIn) {
                        alert('Employee is not clocked in!');
                        return;
                    }
                    
                    const now = new Date();
                    const clockInDate = new Date(employee.clockInTime);
                    const totalMinutesWorked = (now - clockInDate) / (1000 * 60);
                    
                    // Deduct assigned break time
                    const assignedBreakMinutes = employee.assignedBreakMinutes || 30;
                    const netWorkMinutes = totalMinutesWorked - assignedBreakMinutes;
                    const hoursWorked = (netWorkMinutes / 60).toFixed(2);
                    
                    // Create work history entry
                    const workEntry = {
                        id: Date.now(),
                        date: now.toISOString(),
                        clockIn: employee.clockInTime,
                        clockOut: now.toISOString(),
                        hoursWorked: parseFloat(hoursWorked),
                        assignedBreakMinutes: assignedBreakMinutes,
                        wasLate: employee.isLateToday || false,
                        minutesLate: employee.minutesLate || 0,
                        forcedByOwner: true
                    };
                    
                    // Update employee - clock out
                    const updatedEmployees = employees.map(emp => {
                        if (emp.id === employeeId) {
                            return {
                                ...emp,
                                clockedIn: false,
                                clockOutTime: now.toISOString(),
                                workHistory: [...(emp.workHistory || []), workEntry],
                                dailyTasks: emp.dailyTasks.map(task => ({ ...task, completed: false })),
                                isLateToday: false,
                                minutesLate: 0,
                                onBreak: false,
                                breakStartTime: null,
                                breakPausedTime: null,
                                breakTimeUsed: 0,
                                isPaused: false
                            };
                        }
                        return emp;
                    });
                    setEmployees(updatedEmployees);
                    
                    // Sign out the employee
                    SessionManager.clearSession(employee.username);
                    
                    alert('Employee has been clocked out and signed out successfully!');
                }
            };

            const handleAddDailyTask = (employeeId) => {
                if (newDailyTask.trim()) {
                    const updatedEmployees = employees.map(emp => {
                        if (emp.id === employeeId) {
                            return {
                                ...emp,
                                dailyTasks: [...emp.dailyTasks, { id: Date.now(), task: newDailyTask, completed: false }]
                            };
                        }
                        return emp;
                    });
                    setEmployees(updatedEmployees);
                    setNewDailyTask('');
                }
            };

            const handleDeleteDailyTask = (employeeId, taskId) => {
                const updatedEmployees = employees.map(emp => {
                    if (emp.id === employeeId) {
                        return {
                            ...emp,
                            dailyTasks: emp.dailyTasks.filter(task => task.id !== taskId)
                        };
                    }
                    return emp;
                });
                setEmployees(updatedEmployees);
            };

            const handleAddAssignedTask = (employeeId) => {
                if (newAssignedTask.trim()) {
                    const updatedEmployees = employees.map(emp => {
                        if (emp.id === employeeId) {
                            return {
                                ...emp,
                                assignedTasks: [...emp.assignedTasks, { id: Date.now(), task: newAssignedTask, completed: false }]
                            };
                        }
                        return emp;
                    });
                    setEmployees(updatedEmployees);
                    setNewAssignedTask('');
                }
            };
            
            const handleDeleteAssignedTask = (employeeId, taskId) => {
                const updatedEmployees = employees.map(emp => {
                    if (emp.id === employeeId) {
                        return {
                            ...emp,
                            assignedTasks: emp.assignedTasks.filter(task => task.id !== taskId)
                        };
                    }
                    return emp;
                });
                setEmployees(updatedEmployees);
            };
            
            const handleUpdateTaskText = (employeeId, taskId, newText, taskType) => {
                if (!newText.trim()) return;
                
                const updatedEmployees = employees.map(emp => {
                    if (emp.id === employeeId) {
                        return {
                            ...emp,
                            [taskType]: emp[taskType].map(task =>
                                task.id === taskId ? { ...task, task: newText } : task
                            )
                        };
                    }
                    return emp;
                });
                setEmployees(updatedEmployees);
                setEditingTaskId(null);
                setEditingTaskText('');
            };
            
            const handleMoveTask = (employeeId, taskId, direction, taskType) => {
                const updatedEmployees = employees.map(emp => {
                    if (emp.id === employeeId) {
                        const tasks = [...emp[taskType]];
                        const currentIndex = tasks.findIndex(t => t.id === taskId);
                        
                        if (currentIndex === -1) return emp;
                        
                        const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
                        
                        if (newIndex < 0 || newIndex >= tasks.length) return emp;
                        
                        // Swap tasks
                        [tasks[currentIndex], tasks[newIndex]] = [tasks[newIndex], tasks[currentIndex]];
                        
                        return {
                            ...emp,
                            [taskType]: tasks
                        };
                    }
                    return emp;
                });
                setEmployees(updatedEmployees);
            };
            
            const handleMoveEmployee = (employeeId, direction) => {
                const currentIndex = employees.findIndex(emp => emp.id === employeeId);
                
                if (currentIndex === -1) return;
                
                const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
                
                if (newIndex < 0 || newIndex >= employees.length) return;
                
                // Create new array with swapped positions
                const newEmployees = [...employees];
                [newEmployees[currentIndex], newEmployees[newIndex]] = [newEmployees[newIndex], newEmployees[currentIndex]];
                
                setEmployees(newEmployees);
            };
            
            // Owner task handlers
            const toggleOwnerTask = (taskId, taskType) => {
                const updatedTasks = owner[taskType].map(task =>
                    task.id === taskId ? { ...task, completed: !task.completed } : task
                );
                setOwner({ ...owner, [taskType]: updatedTasks });
            };
            
            const handleAddOwnerTask = (taskType, taskText) => {
                if (taskText.trim()) {
                    const newTask = { id: Date.now(), task: taskText, completed: false };
                    setOwner({ 
                        ...owner, 
                        [taskType]: [...owner[taskType], newTask] 
                    });
                }
            };
            
            const handleDeleteOwnerTask = (taskId, taskType) => {
                setOwner({
                    ...owner,
                    [taskType]: owner[taskType].filter(task => task.id !== taskId)
                });
            };
            
            const handleUpdateOwnerTaskText = (taskId, newText, taskType) => {
                if (!newText.trim()) return;
                
                setOwner({
                    ...owner,
                    [taskType]: owner[taskType].map(task =>
                        task.id === taskId ? { ...task, task: newText } : task
                    )
                });
                setEditingTaskId(null);
                setEditingTaskText('');
            };
            
            const handleMoveOwnerTask = (taskId, direction, taskType) => {
                const tasks = [...owner[taskType]];
                const currentIndex = tasks.findIndex(t => t.id === taskId);
                
                if (currentIndex === -1) return;
                
                const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
                
                if (newIndex < 0 || newIndex >= tasks.length) return;
                
                // Swap tasks
                [tasks[currentIndex], tasks[newIndex]] = [tasks[newIndex], tasks[currentIndex]];
                
                setOwner({
                    ...owner,
                    [taskType]: tasks
                });
            };
            
            // New handlers for owner dashboard features
            
            // Filter work history to last 30 days and by date range
            const filterWorkHistory = (workHistory) => {
                if (!workHistory || workHistory.length === 0) return [];
                
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                let filtered = workHistory.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate >= thirtyDaysAgo;
                });
                
                // Apply date range filter if set
                if (dateRangeFilter.start) {
                    const startDate = new Date(dateRangeFilter.start);
                    startDate.setHours(0, 0, 0, 0);
                    filtered = filtered.filter(entry => new Date(entry.date) >= startDate);
                }
                
                if (dateRangeFilter.end) {
                    const endDate = new Date(dateRangeFilter.end);
                    endDate.setHours(23, 59, 59, 999);
                    filtered = filtered.filter(entry => new Date(entry.date) <= endDate);
                }
                
                return filtered;
            };
            
            // Update work entry times
            const handleUpdateWorkEntry = (employeeId, entryId, newClockIn, newClockOut) => {
                const clockInDate = new Date(newClockIn);
                const clockOutDate = new Date(newClockOut);
                
                if (clockOutDate <= clockInDate) {
                    alert('Clock out time must be after clock in time!');
                    return;
                }
                
                const hoursWorked = ((clockOutDate - clockInDate) / (1000 * 60 * 60));
                
                const updatedEmployees = employees.map(emp => {
                    if (emp.id === employeeId) {
                        return {
                            ...emp,
                            workHistory: emp.workHistory.map(entry => 
                                entry.id === entryId 
                                    ? {
                                        ...entry,
                                        clockIn: clockInDate.toISOString(),
                                        clockOut: clockOutDate.toISOString(),
                                        hoursWorked: parseFloat(hoursWorked.toFixed(2)),
                                        date: clockInDate.toISOString()
                                    }
                                    : entry
                            )
                        };
                    }
                    return emp;
                });
                
                setEmployees(updatedEmployees);
                setEditingWorkEntry(null);
            };
            
            // Delete work history entry
            const handleDeleteWorkEntry = (employeeId, entryId) => {
                if (confirm('Are you sure you want to delete this work session? This action cannot be undone.')) {
                    const updatedEmployees = employees.map(emp => {
                        if (emp.id === employeeId) {
                            return {
                                ...emp,
                                workHistory: emp.workHistory.filter(entry => entry.id !== entryId)
                            };
                        }
                        return emp;
                    });
                    
                    setEmployees(updatedEmployees);
                }
            };
            
            // Export employee work history to PDF
            const exportToPDF = (employee) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const filteredHistory = filterWorkHistory(employee.workHistory || []);
                
                // Add title
                doc.setFontSize(20);
                doc.text(`Work History Report`, 105, 20, { align: 'center' });
                
                // Add employee info
                doc.setFontSize(12);
                doc.text(`Employee: ${employee.name}`, 20, 35);
                doc.text(`Username: ${employee.username}`, 20, 42);
                
                // Add date range
                const startDate = dateRangeFilter.start || 'Last 30 Days';
                const endDate = dateRangeFilter.end || 'Today';
                doc.text(`Period: ${startDate} to ${endDate}`, 20, 49);
                
                // Calculate totals
                const totalMinutesPDF = filteredHistory.reduce((sum, entry) => {
                    const clockIn = new Date(entry.clockIn);
                    const clockOut = new Date(entry.clockOut);
                    const totalMinutes = (clockOut - clockIn) / (1000 * 60);
                    const netMinutes = Math.max(0, totalMinutes - (entry.assignedBreakMinutes || 0));
                    return sum + netMinutes;
                }, 0);
                const totalHoursPDF = Math.floor(totalMinutesPDF / 60);
                const totalMinsPDF = Math.floor(totalMinutesPDF % 60);
                doc.setFont(undefined, 'bold');
                doc.text(`Total Net Hours: ${totalHoursPDF}h ${totalMinsPDF}m`, 20, 56);
                doc.setFont(undefined, 'normal');
                
                // Add table headers
                doc.setFontSize(10);
                let y = 70;
                doc.setFont(undefined, 'bold');
                doc.text('Date', 20, y);
                doc.text('Clock In', 50, y);
                doc.text('Clock Out', 85, y);
                doc.text('Total Duration', 120, y);
                doc.text('Break', 155, y);
                doc.text('Net Day Hours', 175, y);
                
                doc.setFont(undefined, 'normal');
                y += 7;
                
                // Group by date
                const historyByDate = {};
                filteredHistory.forEach(entry => {
                    const date = new Date(entry.date).toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    if (!historyByDate[date]) {
                        historyByDate[date] = [];
                    }
                    historyByDate[date].push(entry);
                });
                
                // Add entries grouped by date with daily summaries
                Object.keys(historyByDate).reverse().forEach(date => {
                    const dayEntries = historyByDate[date];
                    
                    // Pre-calculate daily net hours for this date
                    const dayTotalDuration = dayEntries.reduce((sum, entry) => {
                        const clockIn = new Date(entry.clockIn);
                        const clockOut = new Date(entry.clockOut);
                        return sum + ((clockOut - clockIn) / (1000 * 60));
                    }, 0);
                    
                    const assignedBreak = dayEntries[0]?.assignedBreakMinutes || 0;
                    const dayNetMinutes = Math.max(0, dayTotalDuration - assignedBreak);
                    
                    const dayTotalHours = Math.floor(dayTotalDuration / 60);
                    const dayTotalMins = Math.floor(dayTotalDuration % 60);
                    const dayNetHours = Math.floor(dayNetMinutes / 60);
                    const dayNetMins = Math.floor(dayNetMinutes % 60);
                    
                    // Add each session for this day
                    dayEntries.forEach((entry, idx) => {
                        if (y > 270) {
                            doc.addPage();
                            y = 20;
                        }
                        
                        const clockInTime = new Date(entry.clockIn).toLocaleTimeString('en-US', { 
                            hour: '2-digit', 
                            minute: '2-digit', 
                            hour12: true 
                        });
                        const clockOutTime = new Date(entry.clockOut).toLocaleTimeString('en-US', { 
                            hour: '2-digit', 
                            minute: '2-digit', 
                            hour12: true 
                        });
                        
                        const clockIn = new Date(entry.clockIn);
                        const clockOut = new Date(entry.clockOut);
                        const totalMinutes = (clockOut - clockIn) / (1000 * 60);
                        const durationHours = Math.floor(totalMinutes / 60);
                        const durationMins = Math.floor(totalMinutes % 60);
                        
                        const isLastSession = idx === dayEntries.length - 1;
                        
                        doc.text(date, 20, y);
                        doc.text(clockInTime, 50, y);
                        doc.text(clockOutTime, 85, y);
                        doc.text(`${durationHours}h ${durationMins}m`, 120, y);
                        
                        // Only show Break and Net Day Hours on last session of the day
                        if (isLastSession) {
                            doc.text(`-${assignedBreak}m`, 155, y);
                            doc.text(`${dayNetHours}h ${dayNetMins}m`, 175, y);
                        }
                        
                        y += 7;
                    });
                });
                
                // Add total line at the bottom
                if (y > 260) {
                    doc.addPage();
                    y = 20;
                }
                y += 3; // Extra spacing before total line
                doc.setFont(undefined, 'bold');
                doc.text('TOTAL:', 120, y);
                doc.text(`${totalHoursPDF}h ${totalMinsPDF}m`, 175, y);
                doc.setFont(undefined, 'normal');
                
                // Save the PDF
                const fileName = `${employee.name.replace(/\s+/g, '_')}_work_history_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
            };

            const formatTime = (isoString) => {
                if (!isoString) return 'N/A';
                const date = new Date(isoString);
                return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
            };

            const formatDate = (isoString) => {
                if (!isoString) return 'N/A';
                const date = new Date(isoString);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center">
                        <div className="text-white text-2xl">Loading...</div>
                    </div>
                );
            }

            // Role Selection Screen
            if (currentView === 'selectRole') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-6">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(120,119,198,0.1),transparent)]"></div>
                        <div className="max-w-4xl w-full relative">
                            <div className="text-center mb-12">
                                <h1 className="text-6xl font-bold text-white mb-3" style={{ fontFamily: 'Georgia, serif' }}>
                                    WorkFlow
                                </h1>
                                <p className="text-slate-400 text-lg">Employee Management System</p>
                            </div>
                            
                            <div className="grid md:grid-cols-2 gap-6">
                                <button
                                    onClick={() => setCurrentView('ownerLogin')}
                                    className="group relative bg-gradient-to-br from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white rounded-2xl p-12 shadow-2xl transition-all duration-300 hover:scale-105 hover:shadow-amber-500/25"
                                >
                                    <div className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent rounded-2xl"></div>
                                    <div className="relative">
                                        <div className="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-white/30 transition-all">
                                            <Users size={32} />
                                        </div>
                                        <h2 className="text-3xl font-bold mb-2" style={{ fontFamily: 'Georgia, serif' }}>Owner</h2>
                                        <p className="text-amber-100">Access dashboard & manage employees</p>
                                    </div>
                                </button>

                                <button
                                    onClick={() => setCurrentView('employeeLogin')}
                                    className="group relative bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-400 hover:to-indigo-500 text-white rounded-2xl p-12 shadow-2xl transition-all duration-300 hover:scale-105 hover:shadow-blue-500/25"
                                >
                                    <div className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent rounded-2xl"></div>
                                    <div className="relative">
                                        <div className="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-white/30 transition-all">
                                            <Clock size={32} />
                                        </div>
                                        <h2 className="text-3xl font-bold mb-2" style={{ fontFamily: 'Georgia, serif' }}>Employee</h2>
                                        <p className="text-blue-100">Clock in & manage your tasks</p>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Owner Login Screen
            if (currentView === 'ownerLogin') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-6">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(120,119,198,0.1),transparent)]"></div>
                        <div className="max-w-md w-full relative">
                            <button
                                onClick={() => { setCurrentView('selectRole'); setError(''); setLoginForm({ username: '', password: '' }); }}
                                className="text-slate-400 hover:text-white mb-6 flex items-center gap-2 transition-colors"
                            >
                                ← Back
                            </button>
                            
                            <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-2xl p-8 border border-slate-700/50">
                                <div className="w-16 h-16 bg-gradient-to-br from-amber-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <Users size={32} className="text-white" />
                                </div>
                                
                                <h2 className="text-3xl font-bold text-white text-center mb-2" style={{ fontFamily: 'Georgia, serif' }}>
                                    Owner Login
                                </h2>
                                <p className="text-slate-400 text-center mb-8">Access your dashboard</p>
                                
                                {error && (
                                    <div className="bg-red-500/10 border border-red-500/50 text-red-400 px-4 py-3 rounded-lg mb-6 flex items-center gap-2">
                                        <AlertCircle size={18} />
                                        {error}
                                    </div>
                                )}
                                
                                <form onSubmit={handleOwnerLogin} className="space-y-5">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-300 mb-2">Username</label>
                                        <input
                                            type="text"
                                            value={loginForm.username}
                                            onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                                            className="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500 transition-all"
                                            placeholder="Enter username"
                                            required
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-slate-300 mb-2">Password</label>
                                        <input
                                            type="password"
                                            value={loginForm.password}
                                            onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                                            className="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:border-amber-500 transition-all"
                                            placeholder="Enter password"
                                            required
                                        />
                                    </div>
                                    
                                    <button
                                        type="submit"
                                        className="w-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-semibold py-3 rounded-lg shadow-lg transition-all duration-300 hover:shadow-amber-500/25"
                                    >
                                        Sign In
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                );
            }

            // Employee Login Screen
            if (currentView === 'employeeLogin') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-6">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(120,119,198,0.1),transparent)]"></div>
                        <div className="max-w-md w-full relative">
                            <button
                                onClick={() => { setCurrentView('selectRole'); setError(''); setLoginForm({ username: '', password: '' }); }}
                                className="text-slate-400 hover:text-white mb-6 flex items-center gap-2 transition-colors"
                            >
                                ← Back
                            </button>
                            
                            <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-2xl p-8 border border-slate-700/50">
                                <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <Clock size={32} className="text-white" />
                                </div>
                                
                                <h2 className="text-3xl font-bold text-white text-center mb-2" style={{ fontFamily: 'Georgia, serif' }}>
                                    Employee Login
                                </h2>
                                <p className="text-slate-400 text-center mb-8">Start your workday</p>
                                
                                {error && (
                                    <div className="bg-red-500/10 border border-red-500/50 text-red-400 px-4 py-3 rounded-lg mb-6 flex items-center gap-2">
                                        <AlertCircle size={18} />
                                        {error}
                                    </div>
                                )}
                                
                                <form onSubmit={handleEmployeeLogin} className="space-y-5">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-300 mb-2">Username</label>
                                        <input
                                            type="text"
                                            value={loginForm.username}
                                            onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                                            className="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"
                                            placeholder="Enter username"
                                            required
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-slate-300 mb-2">Password</label>
                                        <input
                                            type="password"
                                            value={loginForm.password}
                                            onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                                            className="w-full px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"
                                            placeholder="Enter password"
                                            required
                                        />
                                    </div>
                                    
                                    <button
                                        type="submit"
                                        className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-400 hover:to-indigo-500 text-white font-semibold py-3 rounded-lg shadow-lg transition-all duration-300 hover:shadow-blue-500/25"
                                    >
                                        Sign In
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                );
            }

            // Owner Dashboard
            if (currentView === 'ownerDashboard') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(120,119,198,0.1),transparent)]"></div>
                        
                        <div className="relative border-b border-slate-700/50 bg-slate-800/30 backdrop-blur-xl">
                            <div className="max-w-7xl mx-auto px-6 py-4">
                                <div className="flex justify-between items-center mb-4">
                                    <div>
                                        <h1 className="text-3xl font-bold text-white" style={{ fontFamily: 'Georgia, serif' }}>WorkFlow</h1>
                                        <p className="text-slate-400 text-sm">Owner Dashboard</p>
                                    </div>
                                    <button
                                        onClick={() => {
                                            SessionManager.clearSession();
                                            setCurrentView('selectRole');
                                        }}
                                        className="flex items-center gap-2 px-4 py-2 bg-slate-700/50 hover:bg-slate-700 text-white rounded-lg transition-all"
                                    >
                                        <LogOut size={18} />
                                        Sign Out
                                    </button>
                                </div>
                                
                                {/* Navigation Tabs */}
                                <div className="flex gap-4">
                                    <button
                                        onClick={() => setOwnerDashboardView('history')}
                                        className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                            ownerDashboardView === 'history'
                                                ? 'bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg'
                                                : 'bg-slate-700/50 text-slate-300 hover:bg-slate-700'
                                        }`}
                                    >
                                        Employee Work History
                                    </button>
                                    <button
                                        onClick={() => setOwnerDashboardView('manage')}
                                        className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                            ownerDashboardView === 'manage'
                                                ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white shadow-lg'
                                                : 'bg-slate-700/50 text-slate-300 hover:bg-slate-700'
                                        }`}
                                    >
                                        Manage Employees & Tasks
                                    </button>
                                    <button
                                        onClick={() => setOwnerDashboardView('myTasks')}
                                        className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                            ownerDashboardView === 'myTasks'
                                                ? 'bg-gradient-to-r from-purple-500 to-violet-600 text-white shadow-lg'
                                                : 'bg-slate-700/50 text-slate-300 hover:bg-slate-700'
                                        }`}
                                    >
                                        My Tasks
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="relative max-w-7xl mx-auto px-6 py-8">
                            {/* Employee Work History View */}
                            {ownerDashboardView === 'history' && (
                                <div className="space-y-6">
                                    {/* Header with Date Range Filter */}
                                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                                        <h2 className="text-3xl font-bold text-white">Employee Work History (Last 30 Days)</h2>
                                        
                                        {/* Date Range Filter */}
                                        <div className="flex items-center gap-3 bg-slate-800/50 backdrop-blur-xl rounded-lg p-4 border border-slate-700/50">
                                            <Calendar size={20} className="text-blue-400" />
                                            <div className="flex flex-col sm:flex-row gap-2">
                                                <div className="flex flex-col">
                                                    <label className="text-xs text-slate-400 mb-1">From</label>
                                                    <input
                                                        type="date"
                                                        value={dateRangeFilter.start}
                                                        onChange={(e) => setDateRangeFilter({ ...dateRangeFilter, start: e.target.value })}
                                                        className="px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                    />
                                                </div>
                                                <div className="flex flex-col">
                                                    <label className="text-xs text-slate-400 mb-1">To</label>
                                                    <input
                                                        type="date"
                                                        value={dateRangeFilter.end}
                                                        onChange={(e) => setDateRangeFilter({ ...dateRangeFilter, end: e.target.value })}
                                                        className="px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                    />
                                                </div>
                                                {(dateRangeFilter.start || dateRangeFilter.end) && (
                                                    <button
                                                        onClick={() => setDateRangeFilter({ start: '', end: '' })}
                                                        className="self-end px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded text-sm transition-colors"
                                                    >
                                                        Clear
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {employees.map(employee => {
                                        const filteredHistory = filterWorkHistory(employee.workHistory || []);
                                        const totalMinutes = filteredHistory.reduce((sum, entry) => {
                                            const clockIn = new Date(entry.clockIn);
                                            const clockOut = new Date(entry.clockOut);
                                            const totalMinutes = (clockOut - clockIn) / (1000 * 60);
                                            const netMinutes = Math.max(0, totalMinutes - (entry.assignedBreakMinutes || 0));
                                            return sum + netMinutes;
                                        }, 0);
                                        const totalHours = Math.floor(totalMinutes / 60);
                                        const totalMins = Math.floor(totalMinutes % 60);
                                        
                                        // Group work history by date
                                        const historyByDate = {};
                                        filteredHistory.forEach(entry => {
                                            const date = new Date(entry.date).toLocaleDateString('en-US', { 
                                                year: 'numeric', 
                                                month: 'long', 
                                                day: 'numeric' 
                                            });
                                            if (!historyByDate[date]) {
                                                historyByDate[date] = [];
                                            }
                                            historyByDate[date].push(entry);
                                        });
                                        
                                        return (
                                            <div key={employee.id} className="bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-xl border border-slate-700/50 overflow-hidden">
                                                {/* Employee Header */}
                                                <div className="bg-gradient-to-r from-slate-700/50 to-slate-800/50 p-6 border-b border-slate-700/50">
                                                    <div className="flex justify-between items-center">
                                                        <div>
                                                            <h3 className="text-2xl font-bold text-white mb-2">{employee.name}</h3>
                                                            <div className="flex items-center gap-4">
                                                                <div className="flex items-center gap-2">
                                                                    <div className={`w-3 h-3 rounded-full ${employee.clockedIn ? 'bg-green-500' : 'bg-slate-500'}`}></div>
                                                                    <span className="text-slate-300 text-sm">
                                                                        {employee.clockedIn ? 'Currently Working' : 'Not Working'}
                                                                    </span>
                                                                </div>
                                                                <span className="text-slate-400 text-sm">
                                                                    Total Net Hours: <span className="text-white font-bold">{totalHours}h {totalMins}m</span>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={() => exportToPDF(employee)}
                                                            className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-lg transition-all shadow-lg"
                                                        >
                                                            <Download size={18} />
                                                            Export PDF
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                {/* Work History */}
                                                <div className="p-6">
                                                    {filteredHistory.length === 0 ? (
                                                        <p className="text-slate-400 text-center py-8">No work history in the selected period</p>
                                                    ) : (
                                                        <div className="space-y-4">
                                                            {Object.keys(historyByDate).reverse().map(date => {
                                                                const dayEntries = historyByDate[date];
                                                                
                                                                // Calculate total duration for the day (sum of all sessions)
                                                                const dayTotalDurationMinutes = dayEntries.reduce((sum, entry) => {
                                                                    const clockIn = new Date(entry.clockIn);
                                                                    const clockOut = new Date(entry.clockOut);
                                                                    const totalMinutes = (clockOut - clockIn) / (1000 * 60);
                                                                    return sum + totalMinutes;
                                                                }, 0);
                                                                
                                                                // Get assigned break (assume same for all entries, take from first)
                                                                const assignedBreak = dayEntries[0]?.assignedBreakMinutes || 0;
                                                                
                                                                // Calculate net hours
                                                                const dayNetMinutes = Math.max(0, dayTotalDurationMinutes - assignedBreak);
                                                                
                                                                // Format durations
                                                                const totalHours = Math.floor(dayTotalDurationMinutes / 60);
                                                                const totalMins = Math.floor(dayTotalDurationMinutes % 60);
                                                                const netHours = Math.floor(dayNetMinutes / 60);
                                                                const netMins = Math.floor(dayNetMinutes % 60);
                                                                
                                                                return (
                                                                    <div key={date} className="border-l-4 border-blue-500 pl-4">
                                                                        <div className="flex justify-between items-center mb-3">
                                                                            <h4 className="text-lg font-semibold text-white">{date}</h4>
                                                                            <span className="text-sm text-slate-300">
                                                                                <span className="text-blue-400">{totalHours}h {totalMins}m</span>
                                                                                <span className="text-slate-500 mx-2">-</span>
                                                                                <span className="text-amber-400">{assignedBreak}m</span>
                                                                                <span className="text-slate-500 mx-2">=</span>
                                                                                <span className="text-green-400 font-bold">{netHours}h {netMins}m</span>
                                                                            </span>
                                                                        </div>
                                                                        
                                                                        <div className="space-y-2">
                                                                            {dayEntries.map((entry, idx) => (
                                                                                <div key={entry.id || idx} className="bg-slate-900/30 rounded-lg p-3">
                                                                                    {editingWorkEntry === entry.id ? (
                                                                                        <div className="space-y-3">
                                                                                            <div className="flex gap-4 items-end flex-wrap">
                                                                                                <div className="flex flex-col">
                                                                                                    <label className="text-xs text-slate-400 mb-1">Clock In</label>
                                                                                                    <input
                                                                                                        type="datetime-local"
                                                                                                        defaultValue={new Date(entry.clockIn).toISOString().slice(0, 16)}
                                                                                                        onChange={(e) => setEditingWorkTimes({ ...editingWorkTimes, clockIn: e.target.value })}
                                                                                                        className="px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                                                    />
                                                                                                </div>
                                                                                                <div className="flex flex-col">
                                                                                                    <label className="text-xs text-slate-400 mb-1">Clock Out</label>
                                                                                                    <input
                                                                                                        type="datetime-local"
                                                                                                        defaultValue={new Date(entry.clockOut).toISOString().slice(0, 16)}
                                                                                                        onChange={(e) => setEditingWorkTimes({ ...editingWorkTimes, clockOut: e.target.value })}
                                                                                                        className="px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                                                    />
                                                                                                </div>
                                                                                                <button
                                                                                                    onClick={() => {
                                                                                                        const newClockIn = editingWorkTimes.clockIn || new Date(entry.clockIn).toISOString();
                                                                                                        const newClockOut = editingWorkTimes.clockOut || new Date(entry.clockOut).toISOString();
                                                                                                        handleUpdateWorkEntry(employee.id, entry.id, newClockIn, newClockOut);
                                                                                                    }}
                                                                                                    className="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded transition-colors flex items-center gap-2"
                                                                                                >
                                                                                                    <Save size={16} />
                                                                                                    Save
                                                                                                </button>
                                                                                                <button
                                                                                                    onClick={() => setEditingWorkEntry(null)}
                                                                                                    className="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors flex items-center gap-2"
                                                                                                >
                                                                                                    <X size={16} />
                                                                                                    Cancel
                                                                                                </button>
                                                                                            </div>
                                                                                        </div>
                                                                                    ) : (
                                                                                        <div className="flex justify-between items-center">
                                                                                            <div className="flex gap-6 text-sm items-center flex-wrap">
                                                                                                <span className="text-slate-400">
                                                                                                    Clock In: <span className="text-green-400 font-medium">
                                                                                                        {new Date(entry.clockIn).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}
                                                                                                    </span>
                                                                                                </span>
                                                                                                <span className="text-slate-400">
                                                                                                    Clock Out: <span className="text-red-400 font-medium">
                                                                                                        {new Date(entry.clockOut).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}
                                                                                                    </span>
                                                                                                </span>
                                                                                                {(() => {
                                                                                                    const clockInDate = new Date(entry.clockIn);
                                                                                                    const clockOutDate = new Date(entry.clockOut);
                                                                                                    const totalMinutes = (clockOutDate - clockInDate) / (1000 * 60);
                                                                                                    const totalHours = Math.floor(totalMinutes / 60);
                                                                                                    const totalMins = Math.floor(totalMinutes % 60);
                                                                                                    
                                                                                                    return (
                                                                                                        <span className="text-blue-400">
                                                                                                            Duration: <span className="text-white font-semibold">{totalHours}h {totalMins}m</span>
                                                                                                        </span>
                                                                                                    );
                                                                                                })()}
                                                                                                {entry.wasLate && (
                                                                                                    <span className="px-2 py-1 bg-amber-500/20 border border-amber-500/50 text-amber-400 rounded text-xs font-medium flex items-center gap-1">
                                                                                                        <AlertCircle size={12} />
                                                                                                        Late by {entry.minutesLate} min
                                                                                                    </span>
                                                                                                )}
                                                                                                {entry.autoClockOut && (
                                                                                                    <span className="px-2 py-1 bg-blue-500/20 border border-blue-500/50 text-blue-400 rounded text-xs font-medium">
                                                                                                        Auto Clock-Out
                                                                                                    </span>
                                                                                                )}
                                                                                            </div>
                                                                                            <div className="flex gap-2">
                                                                                                <button
                                                                                                    onClick={() => {
                                                                                                        setEditingWorkEntry(entry.id);
                                                                                                        setEditingWorkTimes({ 
                                                                                                            clockIn: new Date(entry.clockIn).toISOString().slice(0, 16), 
                                                                                                            clockOut: new Date(entry.clockOut).toISOString().slice(0, 16) 
                                                                                                        });
                                                                                                    }}
                                                                                                    className="px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors text-sm flex items-center gap-1"
                                                                                                >
                                                                                                    <Edit2 size={14} />
                                                                                                    Edit
                                                                                                </button>
                                                                                                <button
                                                                                                    onClick={() => handleDeleteWorkEntry(employee.id, entry.id)}
                                                                                                    className="px-3 py-1 bg-red-600 hover:bg-red-500 text-white rounded transition-colors text-sm flex items-center gap-1"
                                                                                                    title="Delete this work session"
                                                                                                >
                                                                                                    <Trash2 size={14} />
                                                                                                    Delete
                                                                                                </button>
                                                                                            </div>
                                                                                        </div>
                                                                                    )}
                                                                                </div>
                                                                            ))}
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                            
                            {/* Manage Employees & Tasks View */}
                            {ownerDashboardView === 'manage' && (
                                <>
                            <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-slate-700/50 mb-8">
                                <h2 className="text-2xl font-bold text-white mb-6 flex items-center gap-2">
                                    <Plus className="text-amber-500" />
                                    Add New Employee
                                </h2>
                                <form onSubmit={handleAddEmployee} className="grid md:grid-cols-4 gap-4">
                                    <input
                                        type="text"
                                        placeholder="Full Name"
                                        value={newEmployee.name}
                                        onChange={(e) => setNewEmployee({ ...newEmployee, name: e.target.value })}
                                        className="px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50"
                                        required
                                    />
                                    <input
                                        type="text"
                                        placeholder="Username"
                                        value={newEmployee.username}
                                        onChange={(e) => setNewEmployee({ ...newEmployee, username: e.target.value })}
                                        className="px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50"
                                        required
                                    />
                                    <input
                                        type="text"
                                        placeholder="Password"
                                        value={newEmployee.password}
                                        onChange={(e) => setNewEmployee({ ...newEmployee, password: e.target.value })}
                                        className="px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50"
                                        required
                                    />
                                    <button
                                        type="submit"
                                        className="bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-semibold py-3 rounded-lg transition-all"
                                    >
                                        Add Employee
                                    </button>
                                </form>
                            </div>

            {/* Sidebar + Detail Layout */}
            <div className="grid md:grid-cols-4 gap-6">
                {/* LEFT SIDEBAR - Employee List */}
                <div className="md:col-span-1">
                    <h3 className="text-lg font-bold text-white mb-4">Employees</h3>
                    <div className="space-y-2">
                        {employees.map((employee, index) => (
                            <div
                                key={employee.id}
                                className={`rounded-lg p-3 transition-all ${
                                    (selectedEmployee === employee.id || (!selectedEmployee && index === 0))
                                        ? 'bg-amber-500/20 border-2 border-amber-500'
                                        : 'bg-slate-800/50 border border-slate-700/50'
                                }`}
                            >
                                <div className="flex items-center gap-2">
                                    <div className="flex flex-col gap-1">
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                handleMoveEmployee(employee.id, 'up');
                                            }}
                                            disabled={index === 0}
                                            className={`p-1 rounded transition-colors ${
                                                index === 0
                                                    ? 'text-slate-600 cursor-not-allowed'
                                                    : 'text-blue-400 hover:text-blue-300 hover:bg-blue-600/20'
                                            }`}
                                            title="Move up"
                                        >
                                            <ChevronUp size={16} />
                                        </button>
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                handleMoveEmployee(employee.id, 'down');
                                            }}
                                            disabled={index === employees.length - 1}
                                            className={`p-1 rounded transition-colors ${
                                                index === employees.length - 1
                                                    ? 'text-slate-600 cursor-not-allowed'
                                                    : 'text-blue-400 hover:text-blue-300 hover:bg-blue-600/20'
                                            }`}
                                            title="Move down"
                                        >
                                            <ChevronDown size={16} />
                                        </button>
                                    </div>
                                    <div 
                                        className="flex-1 min-w-0 cursor-pointer"
                                        onClick={() => setSelectedEmployee(employee.id)}
                                    >
                                        <h4 className="text-white font-bold text-sm truncate">{employee.name}</h4>
                                        <p className="text-slate-400 text-xs truncate">{employee.username}</p>
                                        {employee.clockedIn && (
                                            <span className="inline-block mt-1 px-2 py-0.5 bg-green-500/20 text-green-400 rounded-full text-xs">
                                                {employee.onBreak ? 'On Break' : 'Working'}
                                            </span>
                                        )}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>

                {/* RIGHT PANEL - Employee Details */}
                <div className="md:col-span-3">
                    {(() => {
                        const employee = employees.find(emp => emp.id === (selectedEmployee || employees[0]?.id));
                        if (!employee) {
                            return (
                                <div className="bg-slate-800/50 rounded-xl p-12 text-center border border-slate-700/50">
                                    <p className="text-slate-400">No employees yet. Add your first employee above!</p>
                                </div>
                            );
                        }

                        return (
                            <div key={employee.id} className="bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-xl border border-slate-700/50 overflow-hidden">
                                        <div className="bg-gradient-to-r from-slate-700/50 to-slate-800/50 p-6 border-b border-slate-700/50">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className="flex-1">
                                                    <h3 className="text-2xl font-bold text-white mb-2">{employee.name}</h3>
                                                    <div className="flex flex-wrap gap-4 text-sm">
                                                        {editingEmployee === employee.id ? (
                                                            <div className="flex flex-col gap-3 w-full">
                                                                <div className="flex gap-2">
                                                                    <input
                                                                        type="text"
                                                                        defaultValue={employee.username}
                                                                        onChange={(e) => employee.tempUsername = e.target.value}
                                                                        className="px-3 py-1 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                        placeholder="Username"
                                                                    />
                                                                    <input
                                                                        type="text"
                                                                        defaultValue={employee.password}
                                                                        onChange={(e) => employee.tempPassword = e.target.value}
                                                                        className="px-3 py-1 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                        placeholder="Password"
                                                                    />
                                                                    <button
                                                                        onClick={() => handleUpdateEmployee(employee.id, {
                                                                            username: employee.tempUsername || employee.username,
                                                                            password: employee.tempPassword || employee.password,
                                                                            phone: employee.tempPhone !== undefined ? employee.tempPhone : employee.phone,
                                                                            email: employee.tempEmail !== undefined ? employee.tempEmail : employee.email,
                                                                            allowedIPs: employee.tempAllowedIPs !== undefined ? employee.tempAllowedIPs : employee.allowedIPs,
                                                                            schedule: employee.tempSchedule || employee.schedule || { openingTime: '09:00', closingTime: '17:00', timezone: 'America/Toronto' },
                                                                            assignedBreakMinutes: employee.tempBreakMinutes !== undefined ? employee.tempBreakMinutes : employee.assignedBreakMinutes
                                                                        })}
                                                                        className="px-3 py-1 bg-green-600 hover:bg-green-500 text-white rounded transition-colors"
                                                                    >
                                                                        <Save size={16} />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => setEditingEmployee(null)}
                                                                        className="px-3 py-1 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors"
                                                                    >
                                                                        <X size={16} />
                                                                    </button>
                                                                </div>
                                                                
                                                                <div className="bg-slate-900/30 p-3 rounded-lg">
                                                                    <label className="text-slate-300 text-xs font-semibold mb-2 block">
                                                                        Contact Information
                                                                    </label>
                                                                    <div className="grid grid-cols-2 gap-3">
                                                                        <div>
                                                                            <label className="text-slate-400 text-xs mb-1 block">Phone Number</label>
                                                                            <input
                                                                                type="tel"
                                                                                defaultValue={employee.phone || ''}
                                                                                onChange={(e) => employee.tempPhone = e.target.value}
                                                                                className="w-full px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                                placeholder="Phone number"
                                                                            />
                                                                        </div>
                                                                        <div>
                                                                            <label className="text-slate-400 text-xs mb-1 block">Email Address</label>
                                                                            <input
                                                                                type="email"
                                                                                defaultValue={employee.email || ''}
                                                                                onChange={(e) => employee.tempEmail = e.target.value}
                                                                                className="w-full px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                                placeholder="Email address"
                                                                            />
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div className="bg-slate-900/30 p-3 rounded-lg">
                                                                    <label className="text-slate-300 text-xs font-semibold mb-2 block">
                                                                        ID Document (PDF)
                                                                    </label>
                                                                    <input
                                                                        type="file"
                                                                        accept=".pdf"
                                                                        onChange={(e) => handleFileUpload(e, employee.id)}
                                                                        className="w-full px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm file:mr-4 file:py-1 file:px-3 file:rounded file:border-0 file:bg-amber-500 file:text-white file:cursor-pointer hover:file:bg-amber-400"
                                                                    />
                                                                    {employee.idDocument && (
                                                                        <p className="text-green-400 text-xs mt-2">✓ {employee.idDocument.name}</p>
                                                                    )}
                                                                </div>
                                                                
                                                                <div className="bg-slate-900/30 p-3 rounded-lg">
                                                                    <label className="text-slate-300 text-xs font-semibold mb-2 block">
                                                                        Allowed IP Addresses (comma-separated)
                                                                    </label>
                                                                    <input
                                                                        type="text"
                                                                        defaultValue={employee.allowedIPs?.join(', ') || ''}
                                                                        onChange={(e) => {
                                                                            const ips = e.target.value.split(',').map(ip => ip.trim()).filter(ip => ip);
                                                                            employee.tempAllowedIPs = ips;
                                                                        }}
                                                                        className="w-full px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                        placeholder="e.g., 203.0.113.45, 198.51.100.123"
                                                                    />
                                                                    <p className="text-slate-500 text-xs mt-1">
                                                                        Employee can only login from these IP addresses. Leave empty to allow from anywhere.
                                                                    </p>
                                                                </div>
                                                                
                                                                <div className="bg-slate-900/30 p-3 rounded-lg">
                                                                    <label className="text-slate-300 text-xs font-semibold mb-2 block">
                                                                        Work Schedule
                                                                    </label>
                                                                    <div className="grid grid-cols-4 gap-3">
                                                                        <div>
                                                                            <label className="text-slate-400 text-xs mb-1 block">Opening Time</label>
                                                                            <input
                                                                                type="time"
                                                                                defaultValue={employee.schedule?.openingTime || '09:00'}
                                                                                onChange={(e) => {
                                                                                    if (!employee.tempSchedule) employee.tempSchedule = { ...employee.schedule };
                                                                                    employee.tempSchedule.openingTime = e.target.value;
                                                                                }}
                                                                                className="w-full px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                            />
                                                                        </div>
                                                                        <div>
                                                                            <label className="text-slate-400 text-xs mb-1 block">Closing Time</label>
                                                                            <input
                                                                                type="time"
                                                                                defaultValue={employee.schedule?.closingTime || '17:00'}
                                                                                onChange={(e) => {
                                                                                    if (!employee.tempSchedule) employee.tempSchedule = { ...employee.schedule };
                                                                                    employee.tempSchedule.closingTime = e.target.value;
                                                                                }}
                                                                                className="w-full px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                            />
                                                                        </div>
                                                                        <div>
                                                                            <label className="text-slate-400 text-xs mb-1 block">Break Time</label>
                                                                            <select
                                                                                defaultValue={employee.assignedBreakMinutes || 30}
                                                                                onChange={(e) => {
                                                                                    employee.tempBreakMinutes = parseInt(e.target.value);
                                                                                }}
                                                                                className="w-full px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                            >
                                                                                <option value="15">15 min</option>
                                                                                <option value="30">30 min</option>
                                                                                <option value="45">45 min</option>
                                                                                <option value="60">1 hour</option>
                                                                                <option value="90">1.5 hours</option>
                                                                                <option value="120">2 hours</option>
                                                                            </select>
                                                                        </div>
                                                                        <div>
                                                                            <label className="text-slate-400 text-xs mb-1 block">Timezone</label>
                                                                            <select
                                                                                defaultValue={employee.schedule?.timezone || 'America/Toronto'}
                                                                                onChange={(e) => {
                                                                                    if (!employee.tempSchedule) employee.tempSchedule = { ...employee.schedule };
                                                                                    employee.tempSchedule.timezone = e.target.value;
                                                                                }}
                                                                                className="w-full px-3 py-2 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                            >
                                                                                <optgroup label="🇨🇦 Canada">
                                                                                    <option value="America/St_Johns">Newfoundland Time (NST)</option>
                                                                                    <option value="America/Halifax">Atlantic Time (AST)</option>
                                                                                    <option value="America/Toronto">Eastern Time (EST/EDT)</option>
                                                                                    <option value="America/Winnipeg">Central Time (CST/CDT)</option>
                                                                                    <option value="America/Regina">Saskatchewan (CST)</option>
                                                                                    <option value="America/Edmonton">Mountain Time (MST/MDT)</option>
                                                                                    <option value="America/Vancouver">Pacific Time (PST/PDT)</option>
                                                                                </optgroup>
                                                                                <optgroup label="🇺🇸 United States">
                                                                                    <option value="America/New_York">Eastern Time (EST/EDT)</option>
                                                                                    <option value="America/Chicago">Central Time (CST/CDT)</option>
                                                                                    <option value="America/Denver">Mountain Time (MST/MDT)</option>
                                                                                    <option value="America/Phoenix">Arizona (MST)</option>
                                                                                    <option value="America/Los_Angeles">Pacific Time (PST/PDT)</option>
                                                                                    <option value="America/Anchorage">Alaska Time (AKST/AKDT)</option>
                                                                                    <option value="Pacific/Honolulu">Hawaii Time (HST)</option>
                                                                                </optgroup>
                                                                                <optgroup label="🇮🇳 India">
                                                                                    <option value="Asia/Kolkata">India Standard Time (IST)</option>
                                                                                </optgroup>
                                                                                <optgroup label="🇦🇺 Australia">
                                                                                    <option value="Australia/Perth">Western Australia (AWST)</option>
                                                                                    <option value="Australia/Darwin">Northern Territory (ACST)</option>
                                                                                    <option value="Australia/Adelaide">South Australia (ACST/ACDT)</option>
                                                                                    <option value="Australia/Brisbane">Queensland (AEST)</option>
                                                                                    <option value="Australia/Sydney">New South Wales (AEST/AEDT)</option>
                                                                                    <option value="Australia/Melbourne">Victoria (AEST/AEDT)</option>
                                                                                    <option value="Australia/Hobart">Tasmania (AEST/AEDT)</option>
                                                                                </optgroup>
                                                                                <optgroup label="🇳🇿 New Zealand">
                                                                                    <option value="Pacific/Auckland">New Zealand (NZST/NZDT)</option>
                                                                                    <option value="Pacific/Chatham">Chatham Islands (CHAST/CHADT)</option>
                                                                                </optgroup>
                                                                                <optgroup label="🇬🇧 United Kingdom">
                                                                                    <option value="Europe/London">UK Time (GMT/BST)</option>
                                                                                </optgroup>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <p className="text-slate-500 text-xs mt-2">
                                                                        Set the expected work hours. Late clock-ins will be tracked.
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <>
                                                                <span className="text-slate-400">
                                                                    Username: <span className="text-white font-medium">{employee.username}</span>
                                                                </span>
                                                                <span className="text-slate-400">
                                                                    Password: 
                                                                    <span className="text-white font-medium ml-2">
                                                                        {showPassword[employee.id] ? employee.password : '••••••••'}
                                                                    </span>
                                                                    <button
                                                                        onClick={() => setShowPassword({ ...showPassword, [employee.id]: !showPassword[employee.id] })}
                                                                        className="ml-2 text-blue-400 hover:text-blue-300"
                                                                    >
                                                                        {showPassword[employee.id] ? <EyeOff size={16} /> : <Eye size={16} />}
                                                                    </button>
                                                                </span>
                                                                <span className="text-slate-400 w-full">
                                                                    Work Hours: 
                                                                    <span className="text-white font-medium ml-2">
                                                                        {employee.schedule?.openingTime || '09:00'} - {employee.schedule?.closingTime || '17:00'} ({employee.schedule?.timezone || 'America/Toronto'})
                                                                    </span>
                                                                </span>
                                                                <span className="text-slate-400 w-full">
                                                                    Break Time: 
                                                                    <span className="text-white font-medium ml-2">
                                                                        {employee.assignedBreakMinutes || 30} minutes
                                                                    </span>
                                                                </span>
                                                                <span className="text-slate-400 w-full">
                                                                    Allowed IPs: 
                                                                    <span className="text-white font-medium ml-2">
                                                                        {employee.allowedIPs && employee.allowedIPs.length > 0 
                                                                            ? employee.allowedIPs.join(', ') 
                                                                            : 'No restriction (can login from anywhere)'}
                                                                    </span>
                                                                </span>
                                                                <span className="text-slate-400 w-full">
                                                                    Phone: 
                                                                    <span className="text-white font-medium ml-2">
                                                                        {employee.phone || 'Not provided'}
                                                                    </span>
                                                                </span>
                                                                <span className="text-slate-400 w-full">
                                                                    Email: 
                                                                    <span className="text-white font-medium ml-2">
                                                                        {employee.email || 'Not provided'}
                                                                    </span>
                                                                </span>
                                                                <span className="text-slate-400 w-full">
                                                                    ID Document: 
                                                                    {employee.idDocument ? (
                                                                        <a 
                                                                            href={employee.idDocument.data} 
                                                                            download={employee.idDocument.name}
                                                                            className="text-blue-400 hover:text-blue-300 ml-2 inline-flex items-center gap-1"
                                                                        >
                                                                            <Download size={16} />
                                                                            {employee.idDocument.name}
                                                                        </a>
                                                                    ) : (
                                                                        <span className="text-white font-medium ml-2">Not uploaded</span>
                                                                    )}
                                                                </span>
                                                            </>
                                                        )}
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    {editingEmployee !== employee.id && (
                                                        <>
                                                            <button
                                                                onClick={() => setEditingEmployee(employee.id)}
                                                                className="p-2 bg-blue-600/20 hover:bg-blue-600/30 text-blue-400 rounded-lg transition-all"
                                                                title="Edit credentials"
                                                            >
                                                                <Edit2 size={18} />
                                                            </button>
                                                            <button
                                                                onClick={() => handleClearWorkHistory(employee.id)}
                                                                className="p-2 bg-purple-600/20 hover:bg-purple-600/30 text-purple-400 rounded-lg transition-all"
                                                                title="Clear work history"
                                                            >
                                                                <Trash2 size={18} />
                                                            </button>
                                                            {employee.clockedIn && (
                                                                <button
                                                                    onClick={() => handleForceClockOut(employee.id)}
                                                                    className="p-2 bg-amber-600/20 hover:bg-amber-600/30 text-amber-400 rounded-lg transition-all"
                                                                    title="Clock out & sign out employee"
                                                                >
                                                                    <LogOut size={18} />
                                                                </button>
                                                            )}
                                                            <button
                                                                onClick={() => handleDeleteEmployee(employee.id)}
                                                                className="p-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg transition-all"
                                                                title="Delete employee"
                                                            >
                                                                <Trash2 size={18} />
                                                            </button>
                                                        </>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="flex flex-wrap gap-4">
                                                <div className="flex items-center gap-2">
                                                    <div className={`w-3 h-3 rounded-full ${employee.clockedIn ? 'bg-green-500' : 'bg-red-500'}`}></div>
                                                    <span className="text-slate-300 text-sm font-medium">
                                                        {employee.clockedIn ? 'Clocked In' : 'Clocked Out'}
                                                    </span>
                                                </div>
                                                {employee.clockInTime && (
                                                    <span className="text-slate-400 text-sm">
                                                        Clock In: <span className="text-white">{formatTime(employee.clockInTime)}</span>
                                                        {' '}on{' '}
                                                        <span className="text-white">{formatDate(employee.clockInTime)}</span>
                                                    </span>
                                                )}
                                                {employee.clockOutTime && (
                                                    <span className="text-slate-400 text-sm">
                                                        Clock Out: <span className="text-white">{formatTime(employee.clockOutTime)}</span>
                                                    </span>
                                                )}
                                            </div>
                                        </div>

                                        <div className="grid md:grid-cols-2 gap-6 p-6">
                                            <div>
                                                <h4 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                                    Daily Tasks
                                                    <span className="text-sm font-normal text-slate-400">
                                                        ({employee.dailyTasks.filter(t => t.completed).length}/{employee.dailyTasks.length})
                                                    </span>
                                                </h4>
                                                <div className="space-y-3 mb-4">
                                                    {employee.dailyTasks.map((task, index) => (
                                                        <div key={task.id} className="flex items-center gap-2 bg-slate-900/30 p-3 rounded-lg group">
                                                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${
                                                                task.completed ? 'bg-green-500 border-green-500' : 'border-slate-600'
                                                            }`}>
                                                                {task.completed && <span className="text-white text-xs">✓</span>}
                                                            </div>
                                                            
                                                            {editingTaskId === task.id ? (
                                                                <div className="flex-1 flex gap-2">
                                                                    <input
                                                                        type="text"
                                                                        value={editingTaskText}
                                                                        onChange={(e) => setEditingTaskText(e.target.value)}
                                                                        className="flex-1 px-3 py-1 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                        autoFocus
                                                                    />
                                                                    <button
                                                                        onClick={() => handleUpdateTaskText(employee.id, task.id, editingTaskText, 'dailyTasks')}
                                                                        className="px-2 py-1 bg-green-600 hover:bg-green-500 text-white rounded transition-colors"
                                                                    >
                                                                        <Save size={14} />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => {
                                                                            setEditingTaskId(null);
                                                                            setEditingTaskText('');
                                                                        }}
                                                                        className="px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors"
                                                                    >
                                                                        <X size={14} />
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <span className={`flex-1 ${task.completed ? 'text-slate-500 line-through' : 'text-slate-300'}`}>
                                                                        {task.task}
                                                                    </span>
                                                                    
                                                                    <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-all">
                                                                        <button
                                                                            onClick={() => handleMoveTask(employee.id, task.id, 'up', 'dailyTasks')}
                                                                            disabled={index === 0}
                                                                            className={`p-1 rounded transition-colors ${
                                                                                index === 0 
                                                                                    ? 'text-slate-600 cursor-not-allowed' 
                                                                                    : 'text-blue-400 hover:text-blue-300 hover:bg-blue-600/20'
                                                                            }`}
                                                                            title="Move up"
                                                                        >
                                                                            <ChevronUp size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleMoveTask(employee.id, task.id, 'down', 'dailyTasks')}
                                                                            disabled={index === employee.dailyTasks.length - 1}
                                                                            className={`p-1 rounded transition-colors ${
                                                                                index === employee.dailyTasks.length - 1 
                                                                                    ? 'text-slate-600 cursor-not-allowed' 
                                                                                    : 'text-blue-400 hover:text-blue-300 hover:bg-blue-600/20'
                                                                            }`}
                                                                            title="Move down"
                                                                        >
                                                                            <ChevronDown size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => {
                                                                                setEditingTaskId(task.id);
                                                                                setEditingTaskText(task.task);
                                                                            }}
                                                                            className="p-1 text-amber-400 hover:text-amber-300 hover:bg-amber-600/20 rounded transition-all"
                                                                            title="Edit task"
                                                                        >
                                                                            <Edit2 size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleDeleteDailyTask(employee.id, task.id)}
                                                                            className="p-1 text-red-400 hover:text-red-300 hover:bg-red-600/20 rounded transition-all"
                                                                            title="Delete task"
                                                                        >
                                                                            <Trash2 size={16} />
                                                                        </button>
                                                                    </div>
                                                                </>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="text"
                                                        placeholder="Add daily task..."
                                                        value={editingDailyTasks === employee.id ? newDailyTask : ''}
                                                        onChange={(e) => setNewDailyTask(e.target.value)}
                                                        onFocus={() => setEditingDailyTasks(employee.id)}
                                                        className="flex-1 px-4 py-2 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-sm"
                                                    />
                                                    <button
                                                        onClick={() => {
                                                            handleAddDailyTask(employee.id);
                                                            setEditingDailyTasks(null);
                                                        }}
                                                        className="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-all"
                                                    >
                                                        <Plus size={18} />
                                                    </button>
                                                </div>
                                            </div>

                                            <div>
                                                <h4 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                                    Assigned Tasks
                                                    <span className="text-sm font-normal text-slate-400">
                                                        ({employee.assignedTasks.filter(t => t.completed).length}/{employee.assignedTasks.length})
                                                    </span>
                                                </h4>
                                                <div className="space-y-3 mb-4">
                                                    {employee.assignedTasks.map((task, index) => (
                                                        <div key={task.id} className="flex items-center gap-2 bg-slate-900/30 p-3 rounded-lg group">
                                                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${
                                                                task.completed ? 'bg-green-500 border-green-500' : 'border-slate-600'
                                                            }`}>
                                                                {task.completed && <span className="text-white text-xs">✓</span>}
                                                            </div>
                                                            
                                                            {editingTaskId === task.id ? (
                                                                <div className="flex-1 flex gap-2">
                                                                    <input
                                                                        type="text"
                                                                        value={editingTaskText}
                                                                        onChange={(e) => setEditingTaskText(e.target.value)}
                                                                        className="flex-1 px-3 py-1 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                        autoFocus
                                                                    />
                                                                    <button
                                                                        onClick={() => handleUpdateTaskText(employee.id, task.id, editingTaskText, 'assignedTasks')}
                                                                        className="px-2 py-1 bg-green-600 hover:bg-green-500 text-white rounded transition-colors"
                                                                    >
                                                                        <Save size={14} />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => {
                                                                            setEditingTaskId(null);
                                                                            setEditingTaskText('');
                                                                        }}
                                                                        className="px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors"
                                                                    >
                                                                        <X size={14} />
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <span className={`flex-1 ${task.completed ? 'text-slate-500 line-through' : 'text-slate-300'}`}>
                                                                        {task.task}
                                                                    </span>
                                                                    
                                                                    <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-all">
                                                                        <button
                                                                            onClick={() => handleMoveTask(employee.id, task.id, 'up', 'assignedTasks')}
                                                                            disabled={index === 0}
                                                                            className={`p-1 rounded transition-colors ${
                                                                                index === 0 
                                                                                    ? 'text-slate-600 cursor-not-allowed' 
                                                                                    : 'text-amber-400 hover:text-amber-300 hover:bg-amber-600/20'
                                                                            }`}
                                                                            title="Move up"
                                                                        >
                                                                            <ChevronUp size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleMoveTask(employee.id, task.id, 'down', 'assignedTasks')}
                                                                            disabled={index === employee.assignedTasks.length - 1}
                                                                            className={`p-1 rounded transition-colors ${
                                                                                index === employee.assignedTasks.length - 1 
                                                                                    ? 'text-slate-600 cursor-not-allowed' 
                                                                                    : 'text-amber-400 hover:text-amber-300 hover:bg-amber-600/20'
                                                                            }`}
                                                                            title="Move down"
                                                                        >
                                                                            <ChevronDown size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => {
                                                                                setEditingTaskId(task.id);
                                                                                setEditingTaskText(task.task);
                                                                            }}
                                                                            className="p-1 text-amber-400 hover:text-amber-300 hover:bg-amber-600/20 rounded transition-all"
                                                                            title="Edit task"
                                                                        >
                                                                            <Edit2 size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleDeleteAssignedTask(employee.id, task.id)}
                                                                            className="p-1 text-red-400 hover:text-red-300 hover:bg-red-600/20 rounded transition-all"
                                                                            title="Delete task"
                                                                        >
                                                                            <Trash2 size={16} />
                                                                        </button>
                                                                    </div>
                                                                </>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="text"
                                                        placeholder="Assign new task..."
                                                        value={addingTaskTo === employee.id ? newAssignedTask : ''}
                                                        onChange={(e) => setNewAssignedTask(e.target.value)}
                                                        onFocus={() => setAddingTaskTo(employee.id)}
                                                        className="flex-1 px-4 py-2 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 text-sm"
                                                    />
                                                    <button
                                                        onClick={() => {
                                                            handleAddAssignedTask(employee.id);
                                                            setAddingTaskTo(null);
                                                        }}
                                                        className="px-4 py-2 bg-amber-600 hover:bg-amber-500 text-white rounded-lg transition-all"
                                                    >
                                                        <Plus size={18} />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* Employee Notes Section */}
                                        {employee.notes && (
                                            <div className="p-6 bg-slate-900/30 border-t border-slate-700/50">
                                                <div className="flex items-center gap-2 mb-3">
                                                    <Edit2 size={18} className="text-blue-400" />
                                                    <h4 className="text-lg font-bold text-white">Employee Notes</h4>
                                                </div>
                                                <div className="bg-slate-800/50 border border-slate-700 rounded-lg p-4">
                                                    <p className="text-slate-300 whitespace-pre-wrap">{employee.notes}</p>
                                                </div>
                                                <p className="text-slate-500 text-xs mt-2">
                                                    📝 Written by {employee.name}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                        );
                    })()}
                </div>
            </div>
            </>
            )}
                            
                            {/* My Tasks View */}
                            {ownerDashboardView === 'myTasks' && (
                                <div className="space-y-6">
                                    {/* Owner's Tasks Section */}
                                    <div className="bg-gradient-to-br from-purple-900/50 to-slate-800/50 backdrop-blur-xl rounded-2xl shadow-xl border border-purple-700/50 overflow-hidden">
                                        <div className="bg-gradient-to-r from-purple-700/30 to-purple-800/30 p-6 border-b border-purple-700/50">
                                            <h2 className="text-2xl font-bold text-white mb-2">My Tasks</h2>
                                            <p className="text-purple-200 text-sm">Owner's personal task management</p>
                                        </div>
                                        
                                        <div className="grid md:grid-cols-2 gap-6 p-6">
                                            {/* Owner Daily Tasks */}
                                            <div>
                                                <h4 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                                    Daily Tasks
                                                    <span className="text-sm font-normal text-slate-400">
                                                        ({owner.dailyTasks.filter(t => t.completed).length}/{owner.dailyTasks.length})
                                                    </span>
                                                </h4>
                                                <div className="space-y-3 mb-4">
                                                    {owner.dailyTasks.map((task, index) => (
                                                        <div key={task.id} className="flex items-center gap-2 bg-slate-900/30 p-3 rounded-lg group">
                                                            <div 
                                                                className={`w-5 h-5 rounded border-2 flex items-center justify-center cursor-pointer transition-all ${
                                                                    task.completed ? 'bg-purple-500 border-purple-500' : 'border-slate-600 hover:border-purple-500'
                                                                }`}
                                                                onClick={() => toggleOwnerTask(task.id, 'dailyTasks')}
                                                            >
                                                                {task.completed && <span className="text-white text-xs">✓</span>}
                                                            </div>
                                                            
                                                            {editingTaskId === task.id ? (
                                                                <div className="flex-1 flex gap-2">
                                                                    <input
                                                                        type="text"
                                                                        value={editingTaskText}
                                                                        onChange={(e) => setEditingTaskText(e.target.value)}
                                                                        className="flex-1 px-3 py-1 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                        autoFocus
                                                                    />
                                                                    <button
                                                                        onClick={() => handleUpdateOwnerTaskText(task.id, editingTaskText, 'dailyTasks')}
                                                                        className="px-2 py-1 bg-green-600 hover:bg-green-500 text-white rounded transition-colors"
                                                                    >
                                                                        <Save size={14} />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => {
                                                                            setEditingTaskId(null);
                                                                            setEditingTaskText('');
                                                                        }}
                                                                        className="px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors"
                                                                    >
                                                                        <X size={14} />
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <span className={`flex-1 ${task.completed ? 'text-slate-500 line-through' : 'text-slate-300'}`}>
                                                                        {task.task}
                                                                    </span>
                                                                    
                                                                    <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-all">
                                                                        <button
                                                                            onClick={() => handleMoveOwnerTask(task.id, 'up', 'dailyTasks')}
                                                                            disabled={index === 0}
                                                                            className={`p-1 rounded transition-colors ${
                                                                                index === 0 
                                                                                    ? 'text-slate-600 cursor-not-allowed' 
                                                                                    : 'text-purple-400 hover:text-purple-300 hover:bg-purple-600/20'
                                                                            }`}
                                                                            title="Move up"
                                                                        >
                                                                            <ChevronUp size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleMoveOwnerTask(task.id, 'down', 'dailyTasks')}
                                                                            disabled={index === owner.dailyTasks.length - 1}
                                                                            className={`p-1 rounded transition-colors ${
                                                                                index === owner.dailyTasks.length - 1 
                                                                                    ? 'text-slate-600 cursor-not-allowed' 
                                                                                    : 'text-purple-400 hover:text-purple-300 hover:bg-purple-600/20'
                                                                            }`}
                                                                            title="Move down"
                                                                        >
                                                                            <ChevronDown size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => {
                                                                                setEditingTaskId(task.id);
                                                                                setEditingTaskText(task.task);
                                                                            }}
                                                                            className="p-1 text-purple-400 hover:text-purple-300 hover:bg-purple-600/20 rounded transition-all"
                                                                            title="Edit task"
                                                                        >
                                                                            <Edit2 size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleDeleteOwnerTask(task.id, 'dailyTasks')}
                                                                            className="p-1 text-red-400 hover:text-red-300 hover:bg-red-600/20 rounded transition-all"
                                                                            title="Delete task"
                                                                        >
                                                                            <Trash2 size={16} />
                                                                        </button>
                                                                    </div>
                                                                </>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="text"
                                                        placeholder="Add daily task..."
                                                        value={editingDailyTasks === 'owner' ? newDailyTask : ''}
                                                        onChange={(e) => setNewDailyTask(e.target.value)}
                                                        onFocus={() => setEditingDailyTasks('owner')}
                                                        onKeyPress={(e) => {
                                                            if (e.key === 'Enter') {
                                                                handleAddOwnerTask('dailyTasks', newDailyTask);
                                                                setNewDailyTask('');
                                                                setEditingDailyTasks(null);
                                                            }
                                                        }}
                                                        className="flex-1 px-4 py-2 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500/50 text-sm"
                                                    />
                                                    <button
                                                        onClick={() => {
                                                            handleAddOwnerTask('dailyTasks', newDailyTask);
                                                            setNewDailyTask('');
                                                            setEditingDailyTasks(null);
                                                        }}
                                                        className="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg transition-all"
                                                    >
                                                        <Plus size={18} />
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Owner Assigned Tasks */}
                                            <div>
                                                <h4 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                                    Assigned Tasks
                                                    <span className="text-sm font-normal text-slate-400">
                                                        ({owner.assignedTasks.filter(t => t.completed).length}/{owner.assignedTasks.length})
                                                    </span>
                                                </h4>
                                                <div className="space-y-3 mb-4">
                                                    {owner.assignedTasks.map((task, index) => (
                                                        <div key={task.id} className="flex items-center gap-2 bg-slate-900/30 p-3 rounded-lg group">
                                                            <div 
                                                                className={`w-5 h-5 rounded border-2 flex items-center justify-center cursor-pointer transition-all ${
                                                                    task.completed ? 'bg-purple-500 border-purple-500' : 'border-slate-600 hover:border-purple-500'
                                                                }`}
                                                                onClick={() => toggleOwnerTask(task.id, 'assignedTasks')}
                                                            >
                                                                {task.completed && <span className="text-white text-xs">✓</span>}
                                                            </div>
                                                            
                                                            {editingTaskId === task.id ? (
                                                                <div className="flex-1 flex gap-2">
                                                                    <input
                                                                        type="text"
                                                                        value={editingTaskText}
                                                                        onChange={(e) => setEditingTaskText(e.target.value)}
                                                                        className="flex-1 px-3 py-1 bg-slate-900/50 border border-slate-600 rounded text-white text-sm"
                                                                        autoFocus
                                                                    />
                                                                    <button
                                                                        onClick={() => handleUpdateOwnerTaskText(task.id, editingTaskText, 'assignedTasks')}
                                                                        className="px-2 py-1 bg-green-600 hover:bg-green-500 text-white rounded transition-colors"
                                                                    >
                                                                        <Save size={14} />
                                                                    </button>
                                                                    <button
                                                                        onClick={() => {
                                                                            setEditingTaskId(null);
                                                                            setEditingTaskText('');
                                                                        }}
                                                                        className="px-2 py-1 bg-slate-600 hover:bg-slate-500 text-white rounded transition-colors"
                                                                    >
                                                                        <X size={14} />
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <span className={`flex-1 ${task.completed ? 'text-slate-500 line-through' : 'text-slate-300'}`}>
                                                                        {task.task}
                                                                    </span>
                                                                    
                                                                    <div className="flex gap-1 opacity-0 group-hover:opacity-100 transition-all">
                                                                        <button
                                                                            onClick={() => handleMoveOwnerTask(task.id, 'up', 'assignedTasks')}
                                                                            disabled={index === 0}
                                                                            className={`p-1 rounded transition-colors ${
                                                                                index === 0 
                                                                                    ? 'text-slate-600 cursor-not-allowed' 
                                                                                    : 'text-purple-400 hover:text-purple-300 hover:bg-purple-600/20'
                                                                            }`}
                                                                            title="Move up"
                                                                        >
                                                                            <ChevronUp size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleMoveOwnerTask(task.id, 'down', 'assignedTasks')}
                                                                            disabled={index === owner.assignedTasks.length - 1}
                                                                            className={`p-1 rounded transition-colors ${
                                                                                index === owner.assignedTasks.length - 1 
                                                                                    ? 'text-slate-600 cursor-not-allowed' 
                                                                                    : 'text-purple-400 hover:text-purple-300 hover:bg-purple-600/20'
                                                                            }`}
                                                                            title="Move down"
                                                                        >
                                                                            <ChevronDown size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => {
                                                                                setEditingTaskId(task.id);
                                                                                setEditingTaskText(task.task);
                                                                            }}
                                                                            className="p-1 text-purple-400 hover:text-purple-300 hover:bg-purple-600/20 rounded transition-all"
                                                                            title="Edit task"
                                                                        >
                                                                            <Edit2 size={16} />
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleDeleteOwnerTask(task.id, 'assignedTasks')}
                                                                            className="p-1 text-red-400 hover:text-red-300 hover:bg-red-600/20 rounded transition-all"
                                                                            title="Delete task"
                                                                        >
                                                                            <Trash2 size={16} />
                                                                        </button>
                                                                    </div>
                                                                </>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="text"
                                                        placeholder="Assign new task..."
                                                        value={addingTaskTo === 'owner' ? newAssignedTask : ''}
                                                        onChange={(e) => setNewAssignedTask(e.target.value)}
                                                        onFocus={() => setAddingTaskTo('owner')}
                                                        onKeyPress={(e) => {
                                                            if (e.key === 'Enter') {
                                                                handleAddOwnerTask('assignedTasks', newAssignedTask);
                                                                setNewAssignedTask('');
                                                                setAddingTaskTo(null);
                                                            }
                                                        }}
                                                        className="flex-1 px-4 py-2 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500/50 text-sm"
                                                    />
                                                    <button
                                                        onClick={() => {
                                                            handleAddOwnerTask('assignedTasks', newAssignedTask);
                                                            setNewAssignedTask('');
                                                            setAddingTaskTo(null);
                                                        }}
                                                        className="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg transition-all"
                                                    >
                                                        <Plus size={18} />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Employee Dashboard
            if (currentView === 'employeeDashboard') {
                const allDailyTasksCompleted = currentEmployee.dailyTasks.every(task => task.completed);
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
                        <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(120,119,198,0.1),transparent)]"></div>
                        
                        <div className="relative border-b border-slate-700/50 bg-slate-800/30 backdrop-blur-xl">
                            <div className="max-w-5xl mx-auto px-6 py-4 flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-white" style={{ fontFamily: 'Georgia, serif' }}>WorkFlow</h1>
                                    <p className="text-slate-400 text-sm">Welcome, {currentEmployee.name}</p>
                                </div>
                                <button
                                    onClick={handleEmployeeSignOut}
                                    className="flex items-center gap-2 px-4 py-2 bg-slate-700/50 hover:bg-slate-700 text-white rounded-lg transition-all"
                                >
                                    <LogOut size={18} />
                                    Sign Out
                                </button>
                            </div>
                        </div>

                        <div className="relative max-w-5xl mx-auto px-6 py-8">
                            {error && (
                                <div className="bg-red-500/10 border border-red-500/50 text-red-400 px-4 py-3 rounded-lg mb-6 flex items-center gap-2">
                                    <AlertCircle size={18} />
                                    {error}
                                </div>
                            )}
                            
                            {/* Late Arrival Alert */}
                            {currentEmployee.clockedIn && currentEmployee.isLateToday && (
                                <div className="bg-amber-500/10 border border-amber-500/50 text-amber-400 px-4 py-3 rounded-lg mb-6 flex items-center gap-3">
                                    <AlertCircle size={20} className="flex-shrink-0" />
                                    <div>
                                        <p className="font-semibold">Late Clock-In</p>
                                        <p className="text-sm">
                                            You clocked in {(() => {
                                                const totalMinutes = currentEmployee.minutesLate;
                                                const hours = Math.floor(totalMinutes / 60);
                                                const minutes = totalMinutes % 60;
                                                if (hours > 0 && minutes > 0) {
                                                    return `${hours} hour${hours !== 1 ? 's' : ''} and ${minutes} minute${minutes !== 1 ? 's' : ''}`;
                                                } else if (hours > 0) {
                                                    return `${hours} hour${hours !== 1 ? 's' : ''}`;
                                                } else {
                                                    return `${minutes} minute${minutes !== 1 ? 's' : ''}`;
                                                }
                                            })()} late. 
                                            Expected time: {(() => {
                                                const time = currentEmployee.schedule?.openingTime || '09:00';
                                                const [hours, minutes] = time.split(':');
                                                const hour = parseInt(hours);
                                                const ampm = hour >= 12 ? 'PM' : 'AM';
                                                const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
                                                return `${displayHour}:${minutes} ${ampm}`;
                                            })()}
                                        </p>
                                    </div>
                                </div>
                            )}

                            <div className="bg-gradient-to-br from-blue-600 to-indigo-700 rounded-2xl shadow-2xl p-8 mb-8 text-white">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h2 className="text-3xl font-bold mb-2" style={{ fontFamily: 'Georgia, serif' }}>
                                            {currentEmployee.clockedIn ? (currentEmployee.onBreak ? 'On Break' : 'Currently Working') : 'Start Your Day'}
                                        </h2>
                                        {currentEmployee.clockedIn ? (
                                            <p className="text-blue-100">
                                                Clocked in at <span className="font-semibold">{formatTime(currentEmployee.clockInTime)}</span>
                                                {currentEmployee.onBreak && (
                                                    <span className="ml-2 text-amber-300">
                                                        • {currentEmployee.isPaused ? 'Break paused' : `Time left: ${Math.floor(breakTimeRemaining)}:${String(Math.floor((breakTimeRemaining % 1) * 60)).padStart(2, '0')}`}
                                                    </span>
                                                )}
                                            </p>
                                        ) : (
                                            <p className="text-blue-100">Click the button to clock in</p>
                                        )}
                                    </div>
                                    <div className="flex gap-3">
                                        {!currentEmployee.clockedIn ? (
                                            <button
                                                onClick={handleClockIn}
                                                className="flex items-center gap-3 bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all hover:scale-105"
                                            >
                                                <Clock size={24} />
                                                Clock In
                                            </button>
                                        ) : (
                                            <>
                                                {currentEmployee.onBreak ? (
                                                    <>
                                                        {currentEmployee.isPaused ? (
                                                            <button
                                                                onClick={handleResumeBreak}
                                                                className="flex items-center gap-3 bg-blue-500 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all hover:scale-105"
                                                            >
                                                                <Clock size={24} />
                                                                Resume Break
                                                            </button>
                                                        ) : (
                                                            <button
                                                                onClick={handlePauseBreak}
                                                                className="flex items-center gap-3 bg-amber-500 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all hover:scale-105"
                                                            >
                                                                <Clock size={24} />
                                                                Pause Break
                                                            </button>
                                                        )}
                                                        <button
                                                            onClick={handleEndBreak}
                                                            className="flex items-center gap-3 bg-green-500 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all hover:scale-105"
                                                        >
                                                            <Clock size={24} />
                                                            End Break
                                                        </button>
                                                    </>
                                                ) : (
                                                    <button
                                                        onClick={handleTakeBreak}
                                                        className="flex items-center gap-3 bg-amber-500 text-white px-6 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all hover:scale-105"
                                                    >
                                                        <Coffee size={24} />
                                                        {(() => {
                                                            const assignedMinutes = currentEmployee.assignedBreakMinutes || 30;
                                                            const usedMinutes = currentEmployee.breakTimeUsed || 0;
                                                            const remainingMinutes = assignedMinutes - usedMinutes;
                                                            const mins = Math.floor(remainingMinutes);
                                                            const secs = Math.floor((remainingMinutes % 1) * 60);
                                                            return `Take a Break (${mins}:${String(secs).padStart(2, '0')} left)`;
                                                        })()}
                                                    </button>
                                                )}
                                                <button
                                                    onClick={handleClockOut}
                                                    className="flex items-center gap-3 bg-white text-indigo-600 px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all hover:scale-105"
                                                >
                                                    <Clock size={24} />
                                                    Clock Out
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>

                            <div className={`transition-all duration-300 ${!currentEmployee.clockedIn ? 'pointer-events-none' : ''}`}>
                                <div className={`${!currentEmployee.clockedIn ? 'blur-sm opacity-50' : ''}`}>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-slate-700/50">
                                            <div className="flex items-center justify-between mb-6">
                                                <h3 className="text-2xl font-bold text-white">Daily Tasks</h3>
                                                <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                                    allDailyTasksCompleted 
                                                        ? 'bg-green-500/20 text-green-400' 
                                                        : 'bg-amber-500/20 text-amber-400'
                                                }`}>
                                                    {currentEmployee.dailyTasks.filter(t => t.completed).length}/{currentEmployee.dailyTasks.length}
                                                </span>
                                            </div>
                                            
                                            <div className="space-y-3">
                                                {currentEmployee.dailyTasks.length === 0 ? (
                                                    <p className="text-slate-400 text-center py-8">No daily tasks assigned yet</p>
                                                ) : (
                                                    currentEmployee.dailyTasks.map((task, index) => {
                                                        // Find the first uncompleted task
                                                        const firstUncompletedIndex = currentEmployee.dailyTasks.findIndex(t => !t.completed);
                                                        const isCurrentTask = index === firstUncompletedIndex && !task.completed;
                                                        
                                                        return (
                                                            <button
                                                                key={task.id}
                                                                onClick={() => toggleDailyTask(task.id)}
                                                                className={`w-full flex items-center gap-3 p-4 rounded-lg transition-all group relative ${
                                                                    isCurrentTask 
                                                                        ? 'bg-gradient-to-r from-blue-600/30 to-indigo-600/30 border-2 border-blue-500 shadow-lg shadow-blue-500/20 scale-[1.02]' 
                                                                        : task.completed
                                                                        ? 'bg-slate-900/30'
                                                                        : 'bg-slate-900/30 hover:bg-slate-900/50'
                                                                }`}
                                                            >
                                                                {/* Pulse animation for current task */}
                                                                {isCurrentTask && (
                                                                    <div className="absolute inset-0 rounded-lg bg-blue-500/10 animate-pulse"></div>
                                                                )}
                                                                
                                                                {/* Current task indicator */}
                                                                {isCurrentTask && (
                                                                    <div className="absolute -left-2 top-1/2 -translate-y-1/2 w-1 h-8 bg-blue-500 rounded-full"></div>
                                                                )}
                                                                
                                                                <div className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-all relative z-10 ${
                                                                    task.completed 
                                                                        ? 'bg-green-500 border-green-500' 
                                                                        : isCurrentTask
                                                                        ? 'border-blue-500 ring-2 ring-blue-500/50'
                                                                        : 'border-slate-600 group-hover:border-blue-500'
                                                                }`}>
                                                                    {task.completed && <span className="text-white font-bold">✓</span>}
                                                                </div>
                                                                
                                                                <div className="flex-1 text-left relative z-10">
                                                                    <span className={`block transition-all ${
                                                                        task.completed 
                                                                            ? 'text-slate-500 line-through' 
                                                                            : isCurrentTask 
                                                                            ? 'text-white font-semibold' 
                                                                            : 'text-white'
                                                                    }`}>
                                                                        {task.task}
                                                                    </span>
                                                                    {isCurrentTask && (
                                                                        <span className="text-blue-400 text-xs font-medium mt-1 block">
                                                                            ← Focus on this task now
                                                                        </span>
                                                                    )}
                                                                </div>
                                                                
                                                                {/* Task number indicator */}
                                                                <span className={`text-xs font-bold px-2 py-1 rounded relative z-10 ${
                                                                    task.completed 
                                                                        ? 'bg-green-500/20 text-green-400'
                                                                        : isCurrentTask
                                                                        ? 'bg-blue-500/30 text-blue-300'
                                                                        : 'bg-slate-700/50 text-slate-400'
                                                                }`}>
                                                                    {index + 1}
                                                                </span>
                                                            </button>
                                                        );
                                                    })
                                                )}
                                            </div>
                                        </div>

                                        <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-slate-700/50">
                                            <div className="flex items-center justify-between mb-6">
                                                <h3 className="text-2xl font-bold text-white">Assigned Tasks</h3>
                                                <span className="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-sm font-semibold">
                                                    {currentEmployee.assignedTasks.filter(t => t.completed).length}/{currentEmployee.assignedTasks.length}
                                                </span>
                                            </div>
                                            
                                            <div className="space-y-3">
                                                {currentEmployee.assignedTasks.length === 0 ? (
                                                    <p className="text-slate-400 text-center py-8">No assigned tasks</p>
                                                ) : (
                                                    currentEmployee.assignedTasks.map(task => (
                                                        <button
                                                            key={task.id}
                                                            onClick={() => toggleAssignedTask(task.id)}
                                                            className="w-full flex items-center gap-3 bg-slate-900/30 hover:bg-slate-900/50 p-4 rounded-lg transition-all group"
                                                        >
                                                            <div className={`w-6 h-6 rounded border-2 flex items-center justify-center transition-all ${
                                                                task.completed 
                                                                    ? 'bg-green-500 border-green-500' 
                                                                    : 'border-slate-600 group-hover:border-blue-500'
                                                            }`}>
                                                                {task.completed && <span className="text-white font-bold">✓</span>}
                                                            </div>
                                                            <span className={`flex-1 text-left transition-all ${
                                                                task.completed ? 'text-slate-500 line-through' : 'text-white'
                                                            }`}>
                                                                {task.task}
                                                            </span>
                                                        </button>
                                                    ))
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Notes Section */}
                                    <div className="mt-6 bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-xl p-6 border border-slate-700/50">
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="flex items-center gap-2">
                                                <Edit2 size={20} className="text-blue-400" />
                                                <h3 className="text-2xl font-bold text-white">My Notes</h3>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                {notesSaveStatus === 'saving' ? (
                                                    <span className="text-amber-400 text-sm flex items-center gap-1">
                                                        <svg className="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                        </svg>
                                                        Saving...
                                                    </span>
                                                ) : (
                                                    <span className="text-green-400 text-sm flex items-center gap-1">
                                                        <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path>
                                                        </svg>
                                                        Saved
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                        <textarea
                                            value={currentEmployee.notes || ''}
                                            onChange={(e) => handleNotesChange(e.target.value)}
                                            placeholder="Write Notes...remember important things or updates here."
                                            className="w-full h-40 px-4 py-3 bg-slate-900/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 resize-none"
                                        />
                                        <p className="text-slate-500 text-xs mt-2">
                                            💡 Use this space to remember tasks, important things so you don't miss anything
                                        </p>
                                    </div>
                                </div>
                                
                                {!currentEmployee.clockedIn && (
                                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                                        <div className="bg-slate-800/90 backdrop-blur-sm border border-slate-700 rounded-2xl px-8 py-6 text-center">
                                            <Clock size={48} className="text-blue-400 mx-auto mb-4" />
                                            <p className="text-xl font-bold text-white mb-2">Please Clock In</p>
                                            <p className="text-slate-400">Clock in to access your tasks</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }
            
            return null;
        };
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
